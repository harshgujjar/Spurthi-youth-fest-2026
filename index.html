<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spurthi Youth Fest 2026</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #c44569 0%, #6a1b9a 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .banner { width: 100%; max-width: 1200px; margin: 0 auto 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: block; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 1.8em; }
        .admin-badge { display: inline-block; background: #FFD700; color: #333; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; font-weight: bold; margin-left: 10px; }
        .super-admin-badge { display: inline-block; background: #FF6B6B; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; font-weight: bold; margin-left: 10px; }
        .jury-badge { display: inline-block; background: #4ECDC4; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; font-weight: bold; margin-left: 10px; }
        
        /* Class Indicator */
        .class-indicator {
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
        }
        .class-indicator.active {
            display: block;
        }
        .class-indicator h3 {
            color: #6a1b9a;
            font-size: 1.2em;
            margin-bottom: 8px;
        }
        .class-indicator .class-name {
            color: #c44569;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        /* Admin Dashboard */
        .admin-dashboard {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .dashboard-title {
            color: #c44569;
            font-size: 1.8em;
            margin-bottom: 25px;
            text-align: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 12px 24px; background: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; }
        .tab:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .tab.active { background: linear-gradient(135deg, #c44569 0%, #6a1b9a 100%); color: white; }
        .content { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .form-section { display: none; }
        .form-section.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; transition: border-color 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #c44569; }
        .event-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin: 20px 0; }
        .event-card { padding: 20px; border: 3px solid #ddd; border-radius: 12px; cursor: pointer; transition: all 0.3s; background: white; position: relative; }
        .event-card:hover { border-color: #c44569; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(196, 69, 105, 0.3); }
        .event-card.full { border-color: #f44336; background: #ffebee; cursor: not-allowed; opacity: 0.7; }
        .event-card.full:hover { transform: none; }
        .event-title { font-size: 1.1em; font-weight: bold; margin-bottom: 8px; }
        .event-size { font-size: 0.9em; opacity: 0.8; margin-bottom: 5px; }
        .event-status { font-size: 0.85em; padding: 5px 10px; border-radius: 15px; display: inline-block; margin-top: 5px; font-weight: bold; }
        .status-full { background: #f44336; color: white; }
        .status-available { background: #4CAF50; color: white; }
        .status-limited { background: #FF9800; color: white; }
        .team-member-box { border: 2px solid #c44569; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #f9f9f9; }
        .member-header { color: #6a1b9a; font-weight: bold; margin-bottom: 10px; font-size: 1.1em; }
        .btn { padding: 12px 30px; background: linear-gradient(135deg, #c44569 0%, #6a1b9a 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.2); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn-secondary { background: #666; }
        .btn-small { padding: 6px 12px; font-size: 14px; }
        .btn-success { background: #4CAF50; }
        .btn-danger { background: #f44336; }
        .btn-info { background: #2196F3; }
        .message { padding: 15px; border-radius: 6px; margin-bottom: 20px; display: none; }
        .message.show { display: block; }
        .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); overflow-y: auto; }
        .modal-content { background-color: white; margin: 50px auto; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; }
        .modal-header { font-size: 1.5em; color: #c44569; margin-bottom: 20px; text-align: center; }
        .modal-icon { font-size: 4em; margin-bottom: 20px; text-align: center; }
        .modal-buttons { margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        /* Table Wrapper for Horizontal Scroll */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
        }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; white-space: nowrap; }
        th { background: linear-gradient(135deg, #c44569 0%, #6a1b9a 100%); color: white; font-weight: 600; position: sticky; top: 0; z-index: 10; }
        tr:hover { background: #f5f5f5; }
        
        /* Mobile Responsive Table */
        @media (max-width: 768px) {
            table { min-width: 800px; font-size: 14px; }
            th, td { padding: 8px 6px; }
            .btn-small { padding: 4px 8px; font-size: 12px; }
        }
        .edit-btn { background: #2196F3; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        .edit-btn:hover { background: #1976D2; }
        .delete-btn { background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; }
        .delete-btn:hover { background: #d32f2f; }
        .filter-section { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-section select { flex: 1; min-width: 200px; }
        .admin-only { display: none; }
        .super-admin-only { display: none; }
        .jury-only { display: none; }
        .student-section { background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .cr-section { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #2196F3; }
        
        /* Jury Sheet Styles */
        .criteria-input-group {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
        }
        .criteria-input-group input {
            margin-bottom: 10px;
        }
        .remove-criteria-btn {
            background: #f44336;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .marks-table {
            overflow-x: auto;
        }
        .marks-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        .marks-input:focus {
            border-color: #4CAF50;
        }
        .total-marks {
            font-weight: bold;
            color: #c44569;
            font-size: 1.2em;
        }
        .winner-badge {
            background: #FFD700;
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }
        .runner-badge {
            background: #C0C0C0;
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }
        .jury-password-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #ffc107;
        }
        .results-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .rank-1 {
            border-left: 5px solid #FFD700;
        }
        .rank-2 {
            border-left: 5px solid #C0C0C0;
        }
        .rank-3 {
            border-left: 5px solid #CD7F32;
        }
        
        @media (max-width: 768px) { 
            .event-grid { grid-template-columns: 1fr; } 
            .filter-section { flex-direction: column; }
            .marks-input { width: 60px; }
        }
        
        /* Firebase Status Indicator */
        .firebase-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 999;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .firebase-status:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .status-connected {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        .status-disconnected {
            background: #f44336;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.5);
            animation: blink 1s infinite;
        }
        .status-checking {
            background: #FF9800;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }
        @media (max-width: 768px) {
            .firebase-status {
                bottom: 10px;
                right: 10px;
                padding: 8px 15px;
                font-size: 12px;
            }
            .status-dot {
                width: 10px;
                height: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ============================================ -->
        <!-- TO CHANGE BANNER IMAGE:                      -->
        <!-- Replace "banner.gif?v=5" with your file      -->
        <!-- Supported: .gif, .png, .jpg                  -->
        <!-- ============================================ -->
        <img src="banner.gif?v=5" class="banner">
        
        <div class="header">
            <h1>üéâ SPURTHI YOUTH FEST 2026 üéâ</h1>
            <p id="userInfo"></p>
        </div>

        <!-- Login/Logout Section (Visible to all) -->
        <div class="content" id="loginSection">
            <h2 style="text-align:center;color:#c44569;margin-bottom:25px">Login</h2>
            <div class="form-group">
                <label>Select User Type:</label>
                <select id="userType" onchange="handleUserTypeChange()">
                    <option value="">-- Select --</option>
                    <option value="student">Student</option>
                    <option value="cr">Class Representative (CR)</option>
                    <option value="admin">Admin</option>
                    <option value="superadmin">Super Admin</option>
                    <option value="jury">Jury</option>
                </select>
            </div>
            
            <!-- Student Login -->
            <div id="studentLogin" style="display:none">
                <div class="form-group">
                    <label>Class:</label>
                    <select id="studentClass"></select>
                </div>
                <button class="btn" onclick="studentLogin()">Login as Student</button>
            </div>
            
            <!-- CR Login -->
            <div id="crLogin" style="display:none">
                <div class="form-group">
                    <label>Class:</label>
                    <select id="crClass"></select>
                </div>
                <button class="btn" onclick="crLogin()">Login as CR</button>
            </div>
            
            <!-- Admin Login -->
            <div id="adminLogin" style="display:none">
                <div class="form-group">
                    <label>Admin Password:</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <button class="btn" onclick="adminLogin()">Login as Admin</button>
            </div>
            
            <!-- Super Admin Login -->
            <div id="superAdminLogin" style="display:none">
                <div class="form-group">
                    <label>Super Admin Password:</label>
                    <input type="password" id="superAdminPassword" placeholder="Enter super admin password">
                </div>
                <button class="btn" onclick="superAdminLogin()">Login as Super Admin</button>
            </div>
            
            <!-- Jury Login -->
            <div id="juryLogin" style="display:none">
                <div class="form-group">
                    <label>Select Event:</label>
                    <select id="juryEvent"></select>
                </div>
                <div class="form-group">
                    <label>Jury Password:</label>
                    <input type="password" id="juryPassword" placeholder="Enter jury password for this event">
                </div>
                <div class="form-group">
                    <label>Jury Number (1 or 2):</label>
                    <select id="juryNumber">
                        <option value="">-- Select --</option>
                        <option value="1">Jury 1</option>
                        <option value="2">Jury 2</option>
                    </select>
                </div>
                <button class="btn" onclick="juryLogin()">Login as Jury</button>
            </div>
        </div>

        <!-- Student Enrollment Section -->
        <div class="student-section" id="studentSection" style="display:none">
            <button class="btn btn-secondary" onclick="logout()" style="float:right">Logout</button>
            <h2 style="color:#c44569;margin-bottom:20px">Student Enrollment</h2>
            <div id="enrollMessage" class="message"></div>
            
            <div class="class-indicator" id="classIndicator">
                <h3>You are enrolling for</h3>
                <div class="class-name" id="currentClassName"></div>
            </div>

            <!-- View Class Enrollments Section -->
            <div style="background:#e3f2fd;padding:20px;border-radius:8px;margin-bottom:20px;border:2px solid #2196F3;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                    <h3 style="color:#1976D2;margin:0;">üìä Your Class Enrollments</h3>
                    <button class="btn btn-small" onclick="toggleEnrollmentView()" id="toggleEnrollmentBtn">
                        Hide Details
                    </button>
                </div>
                
                <!-- Event Filter -->
                <div class="form-group" style="margin-bottom:15px;">
                    <label>Filter by Event:</label>
                    <select id="studentEventFilter" onchange="viewStudentClassEnrollments()">
                        <option value="">All Events</option>
                    </select>
                </div>
                
                <div id="studentEnrollmentResults"></div>
            </div>

            <div class="form-group">
                <label>Select Event to Enroll:</label>
                <div class="event-grid" id="eventCardsContainer"></div>
            </div>

            <div id="enrollmentForm" style="display:none">
                <div id="enrollmentFormContent"></div>
                <button class="btn" onclick="submitEnrollment()">Submit Enrollment</button>
                <button class="btn btn-secondary" onclick="cancelEnrollment()">Cancel</button>
            </div>
        </div>

        <!-- CR Section -->
        <div class="cr-section" id="crSection" style="display:none">
            <button class="btn btn-secondary" onclick="logout()" style="float:right">Logout</button>
            <h2 style="color:#2196F3;margin-bottom:20px">Class Representative Dashboard</h2>
            <div id="crMessage" class="message"></div>
            
            <div class="class-indicator active">
                <h3>Managing Class</h3>
                <div class="class-name" id="crClassName"></div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showCRTab('crEnroll')">Enroll Students</button>
                <button class="tab" onclick="showCRTab('crView')">View Enrollments</button>
            </div>

            <div id="crEnroll" class="form-section active">
                <h3 style="margin-bottom:20px">Enroll Students for Your Class</h3>
                <div class="form-group">
                    <label>Select Event:</label>
                    <div class="event-grid" id="crEventCardsContainer"></div>
                </div>

                <div id="crEnrollmentForm" style="display:none">
                    <div id="crEnrollmentFormContent"></div>
                    <button class="btn" onclick="submitCREnrollment()">Submit Enrollment</button>
                    <button class="btn btn-secondary" onclick="cancelCREnrollment()">Cancel</button>
                </div>
            </div>

            <div id="crView" class="form-section">
                <h3 style="margin-bottom:20px">Your Class Enrollments</h3>
                <div class="filter-section">
                    <select id="crFilterEvent" onchange="updateCRView()">
                        <option value="">All Events</option>
                    </select>
                    <button class="btn btn-small" onclick="clearCRFilters()">Clear Filters</button>
                    <button class="btn btn-small btn-success" onclick="downloadCREnrollments()">üì• Download Enrollments</button>
                </div>
                <div id="crSummary" style="margin-bottom:20px"></div>
                <div id="crEnrollmentsContainer"></div>
            </div>
        </div>

        <!-- Admin Section -->
        <div class="admin-only" id="adminSection">
            <button class="btn btn-secondary" onclick="logout()" style="float:right">Logout</button>
            
            <!-- Admin Dashboard -->
            <div class="admin-dashboard">
                <h2 class="dashboard-title">üìä Admin Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">Total Students</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalEvents">0</div>
                        <div class="stat-label">Active Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalClasses">0</div>
                        <div class="stat-label">Classes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalEnrollments">0</div>
                        <div class="stat-label">Total Enrollments</div>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('master')">Master List</button>
                <button class="tab" onclick="showTab('events')">By Events</button>
                <button class="tab super-admin-only" onclick="showTab('jurySetup')">Jury Setup</button>
                <button class="tab" onclick="showTab('results')" id="resultsTab">Results</button>
            </div>

            <div class="content">
                <!-- Master List Tab -->
                <div id="master" class="form-section active">
                    <h2 style="color:#c44569;margin-bottom:20px">Master Enrollment List</h2>
                    <div class="filter-section">
                        <select id="filterClass" onchange="updateMaster()">
                            <option value="">All Classes</option>
                        </select>
                        <select id="filterEvent" onchange="updateMaster()">
                            <option value="">All Events</option>
                        </select>
                        <button class="btn btn-small" onclick="clearFilters()">Clear Filters</button>
                        <button class="btn btn-small btn-success" onclick="downloadMaster()">üì• Download CSV</button>
                    </div>
                    <div id="summaryInfo" style="background:#e3f2fd;padding:15px;border-radius:8px;margin-bottom:20px"></div>
                    <div id="masterContainer"></div>
                </div>

                <!-- Events Tab -->
                <div id="events" class="form-section">
                    <h2 style="color:#c44569;margin-bottom:20px">Enrollments by Events</h2>
                    <button class="btn btn-small btn-success" onclick="downloadEvents()" style="margin-bottom:20px">üì• Download CSV</button>
                    <div id="eventsContainer"></div>
                </div>

                <!-- Jury Setup Tab (Super Admin Only) -->
                <div id="jurySetup" class="form-section super-admin-only">
                    <h2 style="color:#c44569;margin-bottom:20px">Jury Setup & Criteria Management</h2>
                    
                    <div class="form-group">
                        <label>Select Event:</label>
                        <select id="setupEventSelect" onchange="loadEventSetup()">
                            <option value="">-- Select Event --</option>
                        </select>
                    </div>
                    
                    <div id="eventSetupContainer" style="display:none">
                        <div class="jury-password-section">
                            <h3 style="color:#6a1b9a;margin-bottom:15px">üë• Jury Details</h3>
                            
                            <div style="background:#f0f0f0;padding:15px;border-radius:8px;margin-bottom:15px">
                                <h4 style="color:#6a1b9a;margin-bottom:10px">Jury 1</h4>
                                <div class="form-group">
                                    <label>Jury 1 Name:</label>
                                    <input type="text" id="jury1Name" placeholder="e.g., Dr. Smith, Prof. John">
                                </div>
                                <div class="form-group">
                                    <label>Jury 1 Password:</label>
                                    <input type="text" id="jury1Password" placeholder="Set password for Jury 1">
                                </div>
                            </div>
                            
                            <div style="background:#f0f0f0;padding:15px;border-radius:8px;margin-bottom:15px">
                                <h4 style="color:#6a1b9a;margin-bottom:10px">Jury 2</h4>
                                <div class="form-group">
                                    <label>Jury 2 Name:</label>
                                    <input type="text" id="jury2Name" placeholder="e.g., Dr. Jane, Prof. Mary">
                                </div>
                                <div class="form-group">
                                    <label>Jury 2 Password:</label>
                                    <input type="text" id="jury2Password" placeholder="Set password for Jury 2">
                                </div>
                            </div>
                        </div>
                        
                        <h3 style="color:#6a1b9a;margin:20px 0 15px">üìã Evaluation Criteria (5 criteria, 10 marks each)</h3>
                        <div id="criteriaContainer"></div>
                        <button class="btn btn-small btn-info" onclick="addCriterion()" style="margin-top:10px">+ Add Criterion</button>
                        
                        <div style="margin-top:30px">
                            <button class="btn btn-success" onclick="saveEventSetup()">Save Setup</button>
                        </div>
                        
                        <div id="setupMessage" class="message" style="margin-top:20px"></div>
                    </div>
                </div>

                <!-- Results Tab -->
                <div id="results" class="form-section">
                    <h2 style="color:#c44569;margin-bottom:20px">Event Results</h2>
                    
                    <div class="form-group">
                        <label>Select Event:</label>
                        <div style="display:flex;gap:10px;">
                            <select id="resultsEventSelect" onchange="loadEventResults()" style="flex:1">
                                <option value="">-- Select Event --</option>
                            </select>
                            <button class="btn btn-small" onclick="loadEventResults()" style="white-space:nowrap">üîÑ Refresh</button>
                        </div>
                    </div>
                    
                    <!-- Super Admin Only: Publish/Unpublish Results -->
                    <div class="super-admin-only" style="margin:20px 0;padding:15px;background:#fff3cd;border-radius:8px;border:2px solid #ffc107">
                        <h3 style="color:#6a1b9a;margin-bottom:10px">üì¢ Results Management</h3>
                        <p style="color:#666;margin-bottom:15px;font-size:14px">Publish or unpublish results for the selected event.</p>
                        <div style="display:flex;gap:10px;flex-wrap:wrap">
                            <button class="btn btn-danger" onclick="publishResults()">‚úÖ Publish Results to Admins</button>
                            <button class="btn btn-secondary" onclick="unpublishResults()">‚ùå Unpublish Results</button>
                        </div>
                    </div>
                    
                    <div id="resultsContainer"></div>
                </div>
            </div>
        </div>

        <!-- Jury Section -->
        <div class="jury-only" id="jurySection">
            <button class="btn btn-secondary" onclick="logout()" style="float:right">Logout</button>
            
            <div class="content">
                <h2 style="color:#c44569;margin-bottom:20px" id="juryEventTitle">Jury Evaluation Sheet</h2>
                <p style="margin-bottom:20px;color:#666" id="juryInfo"></p>
                
                <div id="juryMessage" class="message"></div>
                
                <div style="margin-bottom:20px;text-align:center">
                    <button class="btn btn-info" onclick="loadJurySheet()" style="margin-right:10px">üîÑ Reload Sheet</button>
                    <button class="btn btn-secondary" onclick="showEnrollmentDebug()">üìä Show Enrollments</button>
                </div>
                
                <div id="jurySheetContainer"></div>
                
                <div style="margin-top:30px;text-align:center">
                    <button class="btn btn-success" onclick="saveMarks()">üíæ Save Marks</button>
                    <button class="btn btn-info" onclick="markAsCompleted()" style="margin-left:10px">‚úÖ Mark as Completed</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Status Indicator -->
    <div class="firebase-status">
        <div class="status-dot status-disconnected" id="statusDot"></div>
        <span id="statusText">Connecting...</span>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <div class="modal-header" id="modalMessage"></div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="confirmAction()">Yes, Proceed</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Enrollment Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">‚úèÔ∏è Edit Enrollment</div>
            <div id="editFormContainer"></div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveEdit()">Save Changes</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration - YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCkjglXJOsXEqGrlavYL4vQ635BV_dbMzY",
            authDomain: "spurthi-youthfest-2026.firebaseapp.com",
            databaseURL: "https://spurthi-youthfest-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "spurthi-youthfest-2026",
            storageBucket: "spurthi-youthfest-2026.firebasestorage.app",
            messagingSenderId: "840281252513",
            appId: "1:840281252513:web:13f32d3239b5f5664ec6e0"
        };

        let db, ref;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            ref = db.ref('youthfest-enrollments');
        } catch (e) { console.error('Firebase error:', e); }

        // Firebase Connection Status Monitor
        let isConnected = false;
        
        function updateFirebaseStatus(connected) {
            isConnected = connected;
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = 'status-dot';
            if (connected) {
                statusDot.classList.add('status-connected');
                statusText.textContent = 'üü¢ Database Connected';
            } else {
                statusDot.classList.add('status-disconnected');
                statusText.textContent = 'üî¥ Database Offline';
            }
        }
        
        // Check Firebase connection
        if (ref) {
            const connectedRef = db.ref('.info/connected');
            connectedRef.on('value', function(snap) {
                if (snap.val() === true) {
                    updateFirebaseStatus(true);
                } else {
                    updateFirebaseStatus(false);
                }
            });
            
            // Initial check after 2 seconds
            setTimeout(function() {
                ref.once('value').then(function() {
                    updateFirebaseStatus(true);
                }).catch(function() {
                    updateFirebaseStatus(false);
                });
            }, 2000);
        } else {
            setTimeout(function() {
                updateFirebaseStatus(false);
            }, 1000);
        }

        // Global Variables
        const classes = ['1st B.Com','2nd B.Com','3rd B.Com','1ST BCA','2ND BCA A SEC','2ND BCA B SEC','3RD BCA A SEC','3RD BCA B SEC','3RD BCA C SEC','2ND BBA','3RD BBA'];
        const events = {
            'Pod Casting': {size:'Individual',count:1,role:false,topic:true,topicLabel:'Topic',allow:false,maxPerClass:1},
            'Mime': {size:'6 Members',count:6,role:true,topic:true,topicLabel:'Theme',allow:false,maxPerClass:1},
            'Interdisciplinary': {size:'5 Members',count:5,role:true,topic:true,topicLabel:'Topic',allow:false,maxPerClass:1},
            'Ramp Walk': {size:'10+5 Members',count:15,role:true,topic:true,topicLabel:'Theme',show:true,allow:false,maxPerClass:1},
            'Quiz': {size:'6 Members',count:6,role:true,allow:false,maxPerClass:1},
            'Vlog': {size:'3 Members',count:3,role:true,topic:true,topicLabel:'Topic',allow:true,maxPerClass:2},
            'YouTube Advertisement': {size:'8 Members',count:8,role:true,prod:true,allow:false,maxPerClass:1},
            'Mad Ads': {size:'8 Members',count:8,role:true,topic:true,topicLabel:'Topic',allow:false,maxPerClass:1},
            'Hand Writing': {size:'Individual',count:1,role:false,lang:true,allow:false,maxPerClass:1},
            'Best of Waste': {size:'2 Members',count:2,role:true,allow:true,maxPerClass:999},
            'Social Awareness Skit': {size:'8 Members',count:8,role:true,cause:true,allow:false,maxPerClass:1},
            'Solo Dance': {size:'Individual',count:1,role:false,allow:true,maxPerClass:5},
            'Group Dance': {size:'5-8 Members',count:5,role:true,allow:false,maxPerClass:1},
            'Nukkad Natak': {size:'8-10 Members',count:8,role:true,cause:true,causeLabel:'Different Cause',allow:false,maxPerClass:1},
            'Case Analysis': {size:'2 Members',count:2,role:true,allow:false,maxPerClass:1}
        };

        let all = [];
        let currentUser = null;
        let studentClass = null;
        let crClass = null;
        let isAdmin = false;
        let isSuperAdmin = false;
        let isCR = false;
        let isJury = false;
        let juryEvent = null;
        let juryNumber = null;
        let selectedEvent = null;
        let adminPassword = 'admin123';
        let superAdminPassword = 'superadmin123';

        // Initialize
        window.onload = function() {
            populateClassSelects();
            populateEventSelects();
            loadData();
            
            // Firebase connection status
            const connectedRef = db.ref('.info/connected');
            connectedRef.on('value', (snap) => {
                const dot = document.getElementById('statusDot');
                const text = document.getElementById('statusText');
                if (snap.val() === true) {
                    dot.className = 'status-dot status-connected';
                    text.textContent = 'Connected';
                } else {
                    dot.className = 'status-dot status-disconnected';
                    text.textContent = 'Disconnected';
                }
            });
        };

        function populateClassSelects() {
            const selects = ['studentClass','crClass','filterClass'];
            selects.forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    classes.forEach(c => {
                        const opt = document.createElement('option');
                        opt.value = c;
                        opt.textContent = c;
                        sel.appendChild(opt);
                    });
                }
            });
        }

        function populateEventSelects() {
            const selects = ['filterEvent','crFilterEvent','setupEventSelect','resultsEventSelect','juryEvent'];
            selects.forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    Object.keys(events).forEach(e => {
                        const opt = document.createElement('option');
                        opt.value = e;
                        opt.textContent = e;
                        sel.appendChild(opt);
                    });
                }
            });
        }

        function loadData() {
            ref.on('value', snap => {
                console.log('=== FIREBASE DATA LOADED (listener) ===');
                console.log('Snapshot exists?', snap.exists());
                
                all = [];
                let childCount = 0;
                if (snap.exists()) {
                    snap.forEach(child => {
                        childCount++;
                        const data = {id: child.key, ...child.val()};
                        console.log('Child #' + childCount + ':', child.key, '‚Üí', data.classYear, '-', data.event, '-', data.name);
                        all.push(data);
                    });
                }
                
                console.log('Total children loaded:', childCount);
                console.log('All array length:', all.length);
                
                // Show class breakdown
                const classCounts = {};
                all.forEach(e => {
                    if (!classCounts[e.classYear]) classCounts[e.classYear] = 0;
                    classCounts[e.classYear]++;
                });
                console.log('Data by class:', classCounts);
                
                if (isAdmin || isSuperAdmin) {
                    updateStats();
                    updateMaster();
                    updateEvents();
                }
                if (isCR) {
                    updateCRView();
                }
                // Update student view when data changes
                if (studentClass && document.getElementById('studentSection').style.display === 'block') {
                    renderEventCards();
                }
            });
        }

        function handleUserTypeChange() {
            const type = document.getElementById('userType').value;
            document.getElementById('studentLogin').style.display = type === 'student' ? 'block' : 'none';
            document.getElementById('crLogin').style.display = type === 'cr' ? 'block' : 'none';
            document.getElementById('adminLogin').style.display = type === 'admin' ? 'block' : 'none';
            document.getElementById('superAdminLogin').style.display = type === 'superadmin' ? 'block' : 'none';
            document.getElementById('juryLogin').style.display = type === 'jury' ? 'block' : 'none';
        }

        function studentLogin() {
            const cls = document.getElementById('studentClass').value;
            if (!cls) { alert('Please select your class'); return; }
            studentClass = cls;
            currentUser = 'Student';
            
            document.getElementById('userInfo').innerHTML = 'Logged in as: <span class="admin-badge">Student - '+cls+'</span>';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('studentSection').style.display = 'block';
            document.getElementById('currentClassName').textContent = cls;
            document.getElementById('classIndicator').classList.add('active');
            
            // Force reload data from Firebase and then render
            console.log('=== STUDENT LOGIN ===');
            console.log('Selected class:', cls);
            console.log('Firebase ref path:', ref.toString());
            
            ref.once('value').then(snap => {
                console.log('Snapshot exists?', snap.exists());
                
                all = [];
                if (snap.exists()) {
                    snap.forEach(child => {
                        const data = {id: child.key, ...child.val()};
                        all.push(data);
                    });
                }
                
                console.log('Total records loaded:', all.length);
                
                // Log first few records
                if (all.length > 0) {
                    console.log('Sample records:');
                    all.slice(0, 3).forEach((rec, i) => {
                        console.log(`  [${i}] Class: "${rec.classYear}" | Event: "${rec.event}" | Name: "${rec.name}"`);
                    });
                }
                
                // Show all unique classes in database
                const uniqueClasses = [...new Set(all.map(e => e.classYear))];
                console.log('Unique classes in database:', uniqueClasses);
                
                // Filter for this class
                const classRecords = all.filter(e => e.classYear === cls);
                console.log(`Records matching "${cls}":`, classRecords.length);
                
                if (classRecords.length > 0) {
                    console.log('Matching records:', classRecords);
                }
                
                // Render cards and view enrollments
                renderEventCards();
                viewStudentClassEnrollments();
                
            }).catch(err => {
                console.error('Firebase read error:', err);
                alert('Error loading data: ' + err.message);
            });
        }

        function crLogin() {
            const cls = document.getElementById('crClass').value;
            if (!cls) { alert('Please select your class'); return; }
            
            crClass = cls;
            isCR = true;
            currentUser = 'CR';
            document.getElementById('userInfo').innerHTML = 'Logged in as: <span class="admin-badge">CR - '+cls+'</span>';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('crSection').style.display = 'block';
            document.getElementById('crClassName').textContent = cls;
            
            // Force reload data from Firebase and then render
            console.log('=== CR LOGIN ===');
            console.log('Selected class:', cls);
            console.log('Firebase ref path:', ref.toString());
            
            ref.once('value').then(snap => {
                console.log('Snapshot exists?', snap.exists());
                
                all = [];
                if (snap.exists()) {
                    snap.forEach(child => {
                        const data = {id: child.key, ...child.val()};
                        all.push(data);
                    });
                }
                
                console.log('Total records loaded:', all.length);
                
                // Log first few records
                if (all.length > 0) {
                    console.log('Sample records:');
                    all.slice(0, 3).forEach((rec, i) => {
                        console.log(`  [${i}] Class: "${rec.classYear}" | Event: "${rec.event}" | Name: "${rec.name}"`);
                    });
                }
                
                // Show all unique classes in database
                const uniqueClasses = [...new Set(all.map(e => e.classYear))];
                console.log('Unique classes in database:', uniqueClasses);
                
                // Filter for this class
                const classRecords = all.filter(e => e.classYear === cls);
                console.log(`Records matching "${cls}":`, classRecords.length);
                
                if (classRecords.length > 0) {
                    console.log('Matching records:', classRecords);
                }
                
                renderCREventCards();
                updateCREventFilter();
                updateCRView();
                
            }).catch(err => {
                console.error('Firebase read error:', err);
                alert('Error loading data: ' + err.message);
            });
        }

        function adminLogin() {
            const pwd = document.getElementById('adminPassword').value;
            if (pwd !== adminPassword) { alert('Invalid admin password'); return; }
            
            isAdmin = true;
            currentUser = 'Admin';
            document.getElementById('userInfo').innerHTML = 'Logged in as: <span class="admin-badge">Admin</span>';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'block';
            
            // Show only basic tabs for admin
            document.querySelectorAll('.super-admin-only').forEach(el => el.style.display = 'none');
            
            // Check if any results are published and show/hide Results tab
            checkResultsPublished();
            
            // Manually trigger data load from Firebase and update displays
            ref.once('value', snap => {
                all = [];
                if (snap.exists()) {
                    snap.forEach(child => {
                        const data = {id: child.key, ...child.val()};
                        all.push(data);
                    });
                }
                updateStats();
                updateMaster();
                updateEvents();
            });
        }

        function superAdminLogin() {
            const pwd = document.getElementById('superAdminPassword').value;
            if (pwd !== superAdminPassword) { alert('Invalid super admin password'); return; }
            
            isAdmin = true;
            isSuperAdmin = true;
            currentUser = 'Super Admin';
            document.getElementById('userInfo').innerHTML = 'Logged in as: <span class="super-admin-badge">Super Admin</span>';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'block';
            
            // Show all tabs including super admin tabs
            document.querySelectorAll('.super-admin-only:not(.form-section)').forEach(el => el.style.display = 'block');
            
            // Super admin always sees Results tab
            document.getElementById('resultsTab').style.display = 'block';
            
            // Manually trigger data load from Firebase and update displays
            ref.once('value', snap => {
                all = [];
                if (snap.exists()) {
                    snap.forEach(child => {
                        const data = {id: child.key, ...child.val()};
                        all.push(data);
                    });
                }
                updateStats();
                updateMaster();
                updateEvents();
            });
        }

        function juryLogin() {
            const event = document.getElementById('juryEvent').value;
            const pwd = document.getElementById('juryPassword').value;
            const num = document.getElementById('juryNumber').value;
            
            if (!event || !pwd || !num) {
                alert('Please fill all fields');
                return;
            }
            
            // Load jury setup to get password and name
            db.ref('jurySetup/'+event).once('value').then(snap => {
                const setup = snap.val();
                if (!setup) {
                    alert('Event setup not found. Contact super admin.');
                    return;
                }
                
                const juryPassword = setup['jury'+num+'Password'];
                const juryName = setup['jury'+num+'Name'] || 'Jury ' + num;
                
                if (juryPassword === pwd) {
                    isJury = true;
                    juryEvent = event;
                    juryNumber = num;
                    currentUser = 'Jury';
                    
                    document.getElementById('userInfo').innerHTML = 'Logged in as: <span class="jury-badge">'+juryName+' - '+event+'</span>';
                    document.getElementById('loginSection').style.display = 'none';
                    document.getElementById('jurySection').style.display = 'block';
                    document.getElementById('juryEventTitle').textContent = 'Jury Evaluation - ' + event;
                    document.getElementById('juryInfo').textContent = 'You are ' + juryName + ' for ' + event;
                    
                    loadJurySheet();
                } else {
                    alert('Invalid jury password for this event');
                }
            }).catch(err => {
                alert('Error loading jury setup: ' + err.message);
            });
        }

        function reloadStudentData() {
            console.log('=== RELOADING DATA FROM FIREBASE ===');
            const statusText = document.getElementById('debugStatusText');
            if (statusText) statusText.innerHTML = 'üîÑ Reloading data from Firebase...';
            
            ref.once('value', snap => {
                console.log('Firebase snapshot exists?', snap.exists());
                console.log('Firebase snapshot:', snap.val());
                
                all = [];
                let childCount = 0;
                if (snap.exists()) {
                    snap.forEach(child => {
                        childCount++;
                        const data = {id: child.key, ...child.val()};
                        console.log('Loading child #' + childCount + ':', child.key, data);
                        all.push(data);
                    });
                }
                
                console.log('‚úÖ Data reloaded!');
                console.log('Total children processed:', childCount);
                console.log('Total records in "all" array:', all.length);
                console.log('All data:', all);
                
                // Show breakdown by class
                const classCounts = {};
                all.forEach(e => {
                    if (!classCounts[e.classYear]) classCounts[e.classYear] = 0;
                    classCounts[e.classYear]++;
                });
                console.log('Records by class:', classCounts);
                
                if (statusText) statusText.innerHTML = '‚úÖ Data reloaded! Total records: ' + all.length + ' | Classes: ' + Object.keys(classCounts).length;
                
                // Also update event cards
                renderEventCards();
                
                let msg = 'Data reloaded!\n\n';
                msg += 'Total records: ' + all.length + '\n';
                msg += 'Classes found: ' + Object.keys(classCounts).join(', ') + '\n\n';
                msg += 'Now click "View Enrollments" or "Show All DB Data"';
                alert(msg);
            }).catch(err => {
                console.error('Firebase error:', err);
                alert('Error loading data: ' + err.message);
                if (statusText) statusText.innerHTML = '‚ùå Error: ' + err.message;
            });
        }
        
        function showAllDatabaseData() {
            console.log('=== SHOWING ALL DATABASE DATA ===');
            const cont = document.getElementById('studentEnrollmentResults');
            
            if (all.length === 0) {
                cont.innerHTML = '<div style="background:#ffebee;color:#c62828;padding:15px;border-radius:6px;border:2px solid #c62828;"><strong>‚ö†Ô∏è NO DATA IN DATABASE</strong><br>The "all" array is empty. Try clicking "Reload Data" first.</div>';
                return;
            }
            
            // Group by class
            const classCounts = {};
            all.forEach(e => {
                if (!classCounts[e.classYear]) classCounts[e.classYear] = [];
                classCounts[e.classYear].push(e);
            });
            
            let html = '<div style="background:#fff;border-radius:6px;padding:15px;border:2px solid #9c27b0;">';
            html += '<h4 style="color:#9c27b0;margin-bottom:15px;">üóÑÔ∏è Complete Database View (Total: ' + all.length + ' records)</h4>';
            
            Object.keys(classCounts).sort().forEach(cls => {
                const enrollments = classCounts[cls];
                const isYourClass = cls === studentClass;
                
                html += '<div style="background:' + (isYourClass ? '#e8f5e9' : '#f5f5f5') + ';padding:12px;border-radius:6px;margin-bottom:10px;border:2px solid ' + (isYourClass ? '#4CAF50' : '#ccc') + ';">';
                html += '<h5 style="color:' + (isYourClass ? '#2e7d32' : '#333') + ';margin-bottom:8px;">';
                html += (isYourClass ? 'üëâ ' : '') + '"' + cls + '" (' + enrollments.length + ' enrollments)' + (isYourClass ? ' ‚Üê YOUR CLASS' : '');
                html += '</h5>';
                
                html += '<table style="width:100%;font-size:12px;"><thead><tr><th>Name</th><th>Phone</th><th>Event</th><th>Role</th></tr></thead><tbody>';
                enrollments.forEach(e => {
                    html += '<tr><td>' + e.name + '</td><td>' + e.phone + '</td><td>' + e.event + '</td><td>' + e.role + '</td></tr>';
                });
                html += '</tbody></table></div>';
            });
            
            html += '</div>';
            cont.innerHTML = html;
        }

        function toggleEnrollmentView() {
            const resultsDiv = document.getElementById('studentEnrollmentResults');
            const btn = document.getElementById('toggleEnrollmentBtn');
            
            if (resultsDiv.style.display === 'none') {
                resultsDiv.style.display = 'block';
                btn.textContent = 'Hide Details';
            } else {
                resultsDiv.style.display = 'none';
                btn.textContent = 'Show Details';
            }
        }

        function viewStudentClassEnrollments() {
            console.log('=== Loading class enrollments ===');
            console.log('Student Class:', studentClass);
            console.log('All enrollments count:', all.length);
            
            const cont = document.getElementById('studentEnrollmentResults');
            
            if (!studentClass) { 
                console.error('ERROR: Student class not set!');
                cont.innerHTML = '<div style="background:#ffebee;color:#c62828;padding:15px;border-radius:6px;border:2px solid #c62828;"><strong>Error:</strong> Student class not set. Please log out and log in again.</div>';
                return; 
            }
            
            console.log('Filtering enrollments for class:', studentClass);
            let classEnr = all.filter(e => e.classYear === studentClass);
            console.log('Filtered enrollments count:', classEnr.length);
            
            // Populate event filter dropdown
            const eventFilter = document.getElementById('studentEventFilter');
            const currentFilter = eventFilter.value;
            
            // Get unique events from class enrollments
            const uniqueEvents = [...new Set(classEnr.map(e => e.event))].sort();
            
            // Update dropdown options
            eventFilter.innerHTML = '<option value="">All Events</option>';
            uniqueEvents.forEach(evt => {
                const option = document.createElement('option');
                option.value = evt;
                option.textContent = evt;
                if (evt === currentFilter) option.selected = true;
                eventFilter.appendChild(option);
            });
            
            // Filter by selected event
            if (currentFilter) {
                classEnr = classEnr.filter(e => e.event === currentFilter);
            }
            
            if (classEnr.length === 0) {
                cont.innerHTML = '<div style="background:#fff3cd;color:#856404;padding:15px;border-radius:6px;border:2px solid #ffc107;text-align:center;"><h4 style="margin-bottom:10px;">No Enrollments</h4><p style="margin:0;">' + (currentFilter ? 'No enrollments found for ' + currentFilter : 'Your class has not enrolled in any events yet.') + '</p></div>';
                return; 
            }
            
            // Group by event
            const eventGroups = {};
            classEnr.forEach(e => {
                if (!eventGroups[e.event]) eventGroups[e.event] = [];
                eventGroups[e.event].push(e);
            });
            
            console.log('Event groups:', eventGroups);
            
            let h = '<div style="background:white;border-radius:6px;padding:15px;border:2px solid #4CAF50;">';
            h += '<h4 style="color:#c44569;margin-bottom:15px;">‚úÖ ' + studentClass + (currentFilter ? ' - ' + currentFilter : '') + ' - Total: ' + classEnr.length + '</h4>';
            
            // Show summary by event (only if showing all events)
            if (!currentFilter) {
                h += '<div style="margin-bottom:20px;">';
                h += '<h5 style="color:#2196F3;margin-bottom:10px;">üìä Enrolled Events:</h5>';
                h += '<div style="display:flex;flex-wrap:wrap;gap:10px;">';
                Object.keys(eventGroups).forEach(evt => {
                    h += '<span style="background:#4CAF50;color:white;padding:8px 15px;border-radius:20px;font-size:14px;font-weight:600;">' + evt + ' (' + eventGroups[evt].length + ')</span>';
                });
                h += '</div></div>';
            }
            
            // Show detailed table
            h += '<div class="table-wrapper"><table><thead><tr><th>Sl</th><th>Name</th><th>Phone</th><th>Event</th><th>Role</th><th>Details</th><th>Actions</th></tr></thead><tbody>';
            classEnr.forEach((e,i) => {
                h += '<tr><td>'+(i+1)+'</td><td>'+e.name+'</td><td>'+e.phone+'</td><td>'+e.event+'</td><td>'+e.role+'</td><td>'+getDet(e)+'</td>';
                h += '<td><button class="edit-btn" data-key="'+e.id+'" onclick="editEnrollmentByKey(this.getAttribute(\'data-key\'))">Edit</button>';
                h += '<button class="delete-btn" data-key="'+e.id+'" data-name="'+e.name+'" data-event="'+e.event+'" onclick="deleteEnrollmentByKey(this.getAttribute(\'data-key\'), this.getAttribute(\'data-name\'), this.getAttribute(\'data-event\'))">Delete</button></td></tr>';
            });
            h += '</tbody></table></div></div>';
            cont.innerHTML = h;
            
            console.log('=== Enrollment display complete ===');
        }

        function logout() {
            studentClass = null;
            crClass = null;
            isAdmin = false;
            isSuperAdmin = false;
            isCR = false;
            isJury = false;
            juryEvent = null;
            juryNumber = null;
            currentUser = null;
            
            document.getElementById('userInfo').innerHTML = '';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('studentSection').style.display = 'none';
            document.getElementById('crSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('jurySection').style.display = 'none';
            document.getElementById('userType').value = '';
            handleUserTypeChange();
        }

        function renderEventCards() {
            const cont = document.getElementById('eventCardsContainer');
            cont.innerHTML = '';
            Object.keys(events).forEach(ev => {
                const cfg = events[ev];
                const enrolled = all.filter(e => e.event===ev && e.classYear===studentClass).length;
                
                // Calculate enrolled teams/participants
                const enrolledCount = cfg.count === 1 ? enrolled : Math.ceil(enrolled / cfg.count);
                const remaining = cfg.maxPerClass - enrolledCount;
                const isFull = remaining <= 0;
                
                const card = document.createElement('div');
                card.className = 'event-card' + (isFull ? ' full' : '');
                card.innerHTML = '<div class="event-title">'+ev+'</div><div class="event-size">'+cfg.size+'</div><div class="event-status '+(isFull?'status-full':(remaining<=1?'status-limited':'status-available'))+'">'+enrolledCount+'/'+cfg.maxPerClass+' enrolled</div>';
                if (!isFull) card.onclick = () => startEnrollment(ev);
                cont.appendChild(card);
            });
        }

        function renderCREventCards() {
            const cont = document.getElementById('crEventCardsContainer');
            cont.innerHTML = '';
            Object.keys(events).forEach(ev => {
                const cfg = events[ev];
                const enrolled = all.filter(e => e.event===ev && e.classYear===crClass).length;
                
                // Calculate enrolled teams/participants
                const enrolledCount = cfg.count === 1 ? enrolled : Math.ceil(enrolled / cfg.count);
                const remaining = cfg.maxPerClass - enrolledCount;
                const isFull = remaining <= 0;
                
                const card = document.createElement('div');
                card.className = 'event-card' + (isFull ? ' full' : '');
                card.innerHTML = '<div class="event-title">'+ev+'</div><div class="event-size">'+cfg.size+'</div><div class="event-status '+(isFull?'status-full':(remaining<=1?'status-limited':'status-available'))+'">'+enrolledCount+'/'+cfg.maxPerClass+' enrolled</div>';
                if (!isFull) card.onclick = () => startCREnrollment(ev);
                cont.appendChild(card);
            });
        }

        function startEnrollment(ev) {
            selectedEvent = ev;
            const cfg = events[ev];
            const enrolled = all.filter(e => e.event===ev && e.classYear===studentClass).length;
            
            // Calculate how many teams/participants are already enrolled
            const enrolledCount = cfg.count === 1 ? enrolled : Math.ceil(enrolled / cfg.count);
            const remaining = cfg.maxPerClass - enrolledCount;
            
            if (remaining <= 0) { alert('Event is full for your class'); return; }
            
            let html = '<h3 style="color:#c44569;margin-bottom:20px">Enroll for: '+ev+'</h3>';
            html += '<p style="margin-bottom:20px;color:#666">'+cfg.size+' | Already Enrolled: '+enrolledCount+' / '+cfg.maxPerClass+'</p>';
            
            // Generate input fields based on team size
            for (let i = 0; i < cfg.count; i++) {
                const roleLabel = cfg.role ? (i === 0 ? 'Captain' : 'Member '+(i+1)) : 'Participant '+(i+1);
                html += '<div class="team-member-box"><div class="member-header">'+roleLabel+'</div>';
                html += '<div class="form-group"><label>Name:</label><input type="text" id="name'+i+'" placeholder="Enter full name"></div>';
                html += '<div class="form-group"><label>Phone Number:</label><input type="tel" id="phone'+i+'" placeholder="10-digit mobile number" maxlength="10"></div>';
                html += '</div>';
            }
            
            // Event-specific fields
            if (cfg.topic) {
                html += '<div class="form-group"><label>'+cfg.topicLabel+':</label><input type="text" id="topic" placeholder="Enter '+cfg.topicLabel.toLowerCase()+'"></div>';
            }
            if (cfg.prod) {
                html += '<div class="form-group"><label>Product Name:</label><input type="text" id="product" placeholder="What product will you advertise?"></div>';
            }
            if (cfg.cause) {
                html += '<div class="form-group"><label>'+(cfg.causeLabel || 'Cause')+':</label><input type="text" id="cause" placeholder="Enter cause/theme"></div>';
            }
            if (cfg.lang) {
                html += '<div class="form-group"><label>Languages:</label><div><label style="display:inline-block;margin-right:15px"><input type="checkbox" id="langEn" checked disabled> English</label><label style="display:inline-block;margin-right:15px"><input type="checkbox" id="langKn"> Kannada</label><label style="display:inline-block"><input type="checkbox" id="langHi"> Hindi</label></div></div>';
            }
            if (cfg.show) {
                html += '<div class="form-group"><label>Showstopper Name:</label><input type="text" id="showstopper" placeholder="Name of showstopper"></div>';
            }
            
            document.getElementById('enrollmentFormContent').innerHTML = html;
            document.getElementById('eventCardsContainer').style.display = 'none';
            document.getElementById('enrollmentForm').style.display = 'block';
        }

        function submitEnrollment() {
            const cfg = events[selectedEvent];
            const members = [];
            
            // Collect all team members
            for (let i = 0; i < cfg.count; i++) {
                const name = document.getElementById('name'+i).value.trim();
                const phone = document.getElementById('phone'+i).value.trim();
                
                if (!name || !phone) { 
                    alert('Please fill all team member fields'); 
                    return; 
                }
                if (!/^\d{10}$/.test(phone)) { 
                    alert('Please enter valid 10-digit phone number for '+name); 
                    return; 
                }
                
                const role = cfg.role ? (i === 0 ? 'Captain' : 'Member') : 'Participant';
                members.push({name: name, phone: phone, role: role});
            }
            
            // Base data for all members
            const baseData = {
                classYear: studentClass,
                event: selectedEvent,
                timestamp: Date.now()
            };
            
            // Add event-specific fields
            if (cfg.topic) {
                const topic = document.getElementById('topic');
                if (!topic || !topic.value.trim()) {
                    alert('Please enter '+cfg.topicLabel);
                    return;
                }
                baseData.topic = topic.value.trim();
            }
            
            if (cfg.prod) {
                const product = document.getElementById('product');
                if (!product || !product.value.trim()) {
                    alert('Please enter product name');
                    return;
                }
                baseData.product = product.value.trim();
            }
            
            if (cfg.cause) {
                const cause = document.getElementById('cause');
                if (!cause || !cause.value.trim()) {
                    alert('Please enter '+(cfg.causeLabel || 'cause'));
                    return;
                }
                baseData.cause = cause.value.trim();
            }
            
            if (cfg.lang) {
                const langs = ['English'];
                const kn = document.getElementById('langKn');
                const hi = document.getElementById('langHi');
                if (kn && kn.checked) langs.push('Kannada');
                if (hi && hi.checked) langs.push('Hindi');
                baseData.languages = langs.join(', ');
            }
            
            if (cfg.show) {
                const show = document.getElementById('showstopper');
                if (!show || !show.value.trim()) {
                    alert('Please enter showstopper name');
                    return;
                }
                baseData.showstopper = show.value.trim();
            }
            
            // Submit all members
            const promises = members.map(m => {
                const data = {...baseData, name: m.name, phone: m.phone, role: m.role};
                return ref.push(data);
            });
            
            Promise.all(promises).then(() => {
                showOk('Successfully enrolled '+members.length+' member(s) for '+selectedEvent+'!');
                cancelEnrollment();
            }).catch(err => showErr('Error: '+err.message));
        }

        function cancelEnrollment() {
            selectedEvent = null;
            document.getElementById('enrollmentForm').style.display = 'none';
            document.getElementById('eventCardsContainer').style.display = 'grid';
        }

        // CR Functions
        function startCREnrollment(ev) {
            selectedEvent = ev;
            const cfg = events[ev];
            const enrolled = all.filter(e => e.event===ev && e.classYear===crClass).length;
            
            // Calculate how many teams/participants are already enrolled
            const enrolledCount = cfg.count === 1 ? enrolled : Math.ceil(enrolled / cfg.count);
            const remaining = cfg.maxPerClass - enrolledCount;
            
            if (remaining <= 0) { alert('Event is full for your class'); return; }
            
            let html = '<h3 style="color:#c44569;margin-bottom:20px">Enroll Students for: '+ev+'</h3>';
            html += '<p style="margin-bottom:20px;color:#666">Class: '+crClass+' | '+cfg.size+' | Enrolled: '+enrolledCount+' / '+cfg.maxPerClass+'</p>';
            
            // Generate input fields based on team size
            for (let i = 0; i < cfg.count; i++) {
                const roleLabel = cfg.role ? (i === 0 ? 'Captain' : 'Member '+(i+1)) : 'Participant '+(i+1);
                html += '<div class="team-member-box"><div class="member-header">'+roleLabel+'</div>';
                html += '<div class="form-group"><label>Name:</label><input type="text" id="crName'+i+'" placeholder="Enter student full name"></div>';
                html += '<div class="form-group"><label>Phone Number:</label><input type="tel" id="crPhone'+i+'" placeholder="10-digit mobile number" maxlength="10"></div>';
                html += '</div>';
            }
            
            // Event-specific fields
            if (cfg.topic) {
                html += '<div class="form-group"><label>'+cfg.topicLabel+':</label><input type="text" id="crTopic" placeholder="Enter '+cfg.topicLabel.toLowerCase()+'"></div>';
            }
            if (cfg.prod) {
                html += '<div class="form-group"><label>Product Name:</label><input type="text" id="crProduct" placeholder="What product will they advertise?"></div>';
            }
            if (cfg.cause) {
                html += '<div class="form-group"><label>'+(cfg.causeLabel || 'Cause')+':</label><input type="text" id="crCause" placeholder="Enter cause/theme"></div>';
            }
            if (cfg.lang) {
                html += '<div class="form-group"><label>Languages:</label><div><label style="display:inline-block;margin-right:15px"><input type="checkbox" id="crLangEn" checked disabled> English</label><label style="display:inline-block;margin-right:15px"><input type="checkbox" id="crLangKn"> Kannada</label><label style="display:inline-block"><input type="checkbox" id="crLangHi"> Hindi</label></div></div>';
            }
            if (cfg.show) {
                html += '<div class="form-group"><label>Showstopper Name:</label><input type="text" id="crShowstopper" placeholder="Name of showstopper"></div>';
            }
            
            document.getElementById('crEnrollmentFormContent').innerHTML = html;
            document.getElementById('crEventCardsContainer').style.display = 'none';
            document.getElementById('crEnrollmentForm').style.display = 'block';
        }

        function submitCREnrollment() {
            const cfg = events[selectedEvent];
            const members = [];
            
            // Collect all team members
            for (let i = 0; i < cfg.count; i++) {
                const name = document.getElementById('crName'+i).value.trim();
                const phone = document.getElementById('crPhone'+i).value.trim();
                
                if (!name || !phone) { 
                    alert('Please fill all team member fields'); 
                    return; 
                }
                if (!/^\d{10}$/.test(phone)) { 
                    alert('Please enter valid 10-digit phone number for '+name); 
                    return; 
                }
                
                const role = cfg.role ? (i === 0 ? 'Captain' : 'Member') : 'Participant';
                members.push({name: name, phone: phone, role: role});
            }
            
            // Base data for all members
            const baseData = {
                classYear: crClass,
                event: selectedEvent,
                enrolledBy: 'CR',
                timestamp: Date.now()
            };
            
            // Add event-specific fields
            if (cfg.topic) {
                const topic = document.getElementById('crTopic');
                if (!topic || !topic.value.trim()) {
                    alert('Please enter '+cfg.topicLabel);
                    return;
                }
                baseData.topic = topic.value.trim();
            }
            
            if (cfg.prod) {
                const product = document.getElementById('crProduct');
                if (!product || !product.value.trim()) {
                    alert('Please enter product name');
                    return;
                }
                baseData.product = product.value.trim();
            }
            
            if (cfg.cause) {
                const cause = document.getElementById('crCause');
                if (!cause || !cause.value.trim()) {
                    alert('Please enter '+(cfg.causeLabel || 'cause'));
                    return;
                }
                baseData.cause = cause.value.trim();
            }
            
            if (cfg.lang) {
                const langs = ['English'];
                const kn = document.getElementById('crLangKn');
                const hi = document.getElementById('crLangHi');
                if (kn && kn.checked) langs.push('Kannada');
                if (hi && hi.checked) langs.push('Hindi');
                baseData.languages = langs.join(', ');
            }
            
            if (cfg.show) {
                const show = document.getElementById('crShowstopper');
                if (!show || !show.value.trim()) {
                    alert('Please enter showstopper name');
                    return;
                }
                baseData.showstopper = show.value.trim();
            }
            
            // Submit all members
            const promises = members.map(m => {
                const data = {...baseData, name: m.name, phone: m.phone, role: m.role};
                return ref.push(data);
            });
            
            Promise.all(promises).then(() => {
                showCROk('Successfully enrolled '+members.length+' student(s) for '+selectedEvent+'!');
                cancelCREnrollment();
            }).catch(err => showCRErr('Error: '+err.message));
        }

        function cancelCREnrollment() {
            selectedEvent = null;
            document.getElementById('crEnrollmentForm').style.display = 'none';
            document.getElementById('crEventCardsContainer').style.display = 'grid';
        }

        function showCRTab(tab) {
            document.querySelectorAll('#crSection .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#crSection .form-section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function updateCREventFilter() {
            const sel = document.getElementById('crFilterEvent');
            sel.innerHTML = '<option value="">All Events</option>';
            const enrolled = [...new Set(all.filter(e => e.classYear === crClass).map(e => e.event))];
            enrolled.forEach(ev => {
                const opt = document.createElement('option');
                opt.value = ev;
                opt.textContent = ev;
                sel.appendChild(opt);
            });
        }

        function updateCRView() {
            console.log('=== updateCRView called ===');
            console.log('crClass:', crClass);
            console.log('all.length:', all.length);
            
            const filterEv = document.getElementById('crFilterEvent').value;
            let filtered = all.filter(e => e.classYear === crClass);
            
            console.log('Filtered by class:', filtered.length);
            
            if (filterEv) {
                filtered = filtered.filter(e => e.event === filterEv);
                console.log('Filtered by event:', filtered.length);
            }
            
            // Summary
            let summary = '<h3 style="color:#2196F3;margin-bottom:10px">Your Class: <strong>'+crClass+'</strong></h3>';
            summary += '<p><strong>Total Students Enrolled:</strong> '+filtered.length+'</p>';
            if (filterEv) summary += '<p><strong>Event:</strong> '+filterEv+'</p>';
            document.getElementById('crSummary').innerHTML = summary;
            
            // Table
            const cont = document.getElementById('crEnrollmentsContainer');
            if (filtered.length === 0) {
                console.log('No enrollments found - showing empty message');
                cont.innerHTML = '<p style="text-align:center;padding:40px;color:#999">No enrollments yet</p>';
            } else {
                console.log('Building table with', filtered.length, 'rows');
                let html = '<div class="table-wrapper"><table><thead><tr><th>Sl</th><th>Name</th><th>Phone</th><th>Event</th><th>Role</th><th>Details</th><th>Actions</th></tr></thead><tbody>';
                filtered.forEach((e,i) => {
                    html += '<tr><td>'+(i+1)+'</td><td>'+e.name+'</td><td>'+e.phone+'</td><td>'+e.event+'</td><td>'+e.role+'</td><td>'+getDet(e)+'</td>';
                    html += '<td><button class="edit-btn" data-key="'+e.id+'" onclick="editEnrollmentByKey(this.getAttribute(\'data-key\'))">Edit</button>';
                    html += '<button class="delete-btn" data-key="'+e.id+'" data-name="'+e.name+'" data-event="'+e.event+'" onclick="deleteEnrollmentByKey(this.getAttribute(\'data-key\'), this.getAttribute(\'data-name\'), this.getAttribute(\'data-event\'))">Delete</button></td></tr>';
                });
                html += '</tbody></table></div>';
                cont.innerHTML = html;
            }
            
            // Update CR event cards to show current enrollment counts
            renderCREventCards();
        }

        function clearCRFilters() {
            document.getElementById('crFilterEvent').value = '';
            updateCRView();
        }

        function downloadCREnrollments() {
            console.log('=== DOWNLOAD CR ENROLLMENTS ===');
            console.log('CR Class:', crClass);
            console.log('Total records in all:', all.length);
            
            if (!crClass) {
                alert('Error: Class not set. Please log out and log in again.');
                return;
            }
            
            // Filter all enrollments for this CR's class
            const classEnrollments = all.filter(e => e.classYear === crClass);
            
            console.log('Filtered enrollments for', crClass, ':', classEnrollments.length);
            
            if (classEnrollments.length === 0) {
                alert('No enrollments to download for ' + crClass);
                return;
            }
            
            // Check if event filter is applied
            const filterEv = document.getElementById('crFilterEvent').value;
            let enrollmentsToDownload = classEnrollments;
            
            if (filterEv) {
                enrollmentsToDownload = classEnrollments.filter(e => e.event === filterEv);
                console.log('Filtered by event', filterEv, ':', enrollmentsToDownload.length);
            }
            
            // Create CSV content
            let csv = 'Sl,Name,Phone,Class,Event,Role,Details\n';
            enrollmentsToDownload.forEach((e, i) => {
                const details = getDet(e).replace(/<br>/g, ' | ').replace(/"/g, '""');
                csv += `${i+1},"${e.name}","${e.phone}","${e.classYear}","${e.event}","${e.role}","${details}"\n`;
            });
            
            // Generate filename
            const filename = filterEv 
                ? `${crClass}_${filterEv}_enrollments.csv`.replace(/\s+/g, '_')
                : `${crClass}_all_enrollments.csv`.replace(/\s+/g, '_');
            
            console.log('Downloading', enrollmentsToDownload.length, 'records as', filename);
            
            // Download
            download(csv, filename);
            
            showCROk(`Downloaded ${enrollmentsToDownload.length} enrollment(s) successfully!`);
        }

        function showCROk(msg) {
            const d = document.getElementById('crMessage');
            d.className = 'message success show';
            d.textContent = '‚úì '+msg;
            setTimeout(() => d.classList.remove('show'), 5000);
        }

        function showCRErr(msg) {
            const d = document.getElementById('crMessage');
            d.className = 'message error show';
            d.textContent = '‚úó '+msg;
            setTimeout(() => d.classList.remove('show'), 5000);
        }

        // Admin Functions
        function showTab(tab) {
            document.querySelectorAll('#adminSection .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#adminSection .form-section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
            
            if (tab === 'results') {
                loadResultsTab();
            }
        }

        function updateStats() {
            const uniqueStudents = new Set(all.map(e => e.phone)).size;
            const uniqueClasses = new Set(all.map(e => e.classYear)).size;
            const activeEvents = new Set(all.map(e => e.event)).size;
            
            document.getElementById('totalStudents').textContent = uniqueStudents;
            document.getElementById('totalEvents').textContent = activeEvents;
            document.getElementById('totalClasses').textContent = uniqueClasses;
            document.getElementById('totalEnrollments').textContent = all.length;
        }

        function updateMaster() {
            // Use setTimeout to ensure dropdown has updated
            setTimeout(() => {
                const filterCl = document.getElementById('filterClass') ? document.getElementById('filterClass').value : '';
                const filterEv = document.getElementById('filterEvent') ? document.getElementById('filterEvent').value : '';
                
                let filtered = [...all]; // Create a copy
                
                if (filterCl) {
                    filtered = filtered.filter(e => e.classYear === filterCl);
                }
                
                if (filterEv) {
                    filtered = filtered.filter(e => e.event === filterEv);
                }
                
                updateSummary(filterCl, filterEv);
                
                const cont = document.getElementById('masterContainer');
                if (!cont) {
                    return;
                }
                
                if (filtered.length === 0) {
                    cont.innerHTML = '<p style="text-align:center;padding:40px;color:#999">No data available</p>';
                    return;
                }
                
                let html = '<div class="table-wrapper"><table><thead><tr><th>Sl</th><th>Name</th><th>Phone</th><th>Class</th><th>Event</th><th>Role</th><th>Details</th><th>Actions</th></tr></thead><tbody>';
                filtered.forEach((e,i) => {
                    html += '<tr><td>'+(i+1)+'</td><td>'+e.name+'</td><td>'+e.phone+'</td><td>'+e.classYear+'</td><td>'+e.event+'</td><td>'+e.role+'</td><td>'+getDet(e)+'</td>';
                    html += '<td><button class="edit-btn" data-key="'+e.id+'" onclick="editEnrollmentByKey(this.getAttribute(\'data-key\'))">Edit</button>';
                    html += '<button class="delete-btn" data-key="'+e.id+'" data-name="'+e.name+'" data-event="'+e.event+'" onclick="deleteEnrollmentByKey(this.getAttribute(\'data-key\'), this.getAttribute(\'data-name\'), this.getAttribute(\'data-event\'))">Delete</button></td></tr>';
                });
                html += '</tbody></table></div>';
                cont.innerHTML = html;
            }, 10); // Small delay to ensure dropdown has updated
        }

        function updateSummary(selectedClass, selectedEvent) {
            const summaryContent = document.getElementById('summaryInfo');
            let html = '<h3 style="color:#2196F3;margin-bottom:15px">üìä Summary</h3>';
            html += '<p><strong>Total Enrollments:</strong> '+all.length+'</p>';
            
            // When Event is selected (no class) - show class enrollment status
            if (!selectedClass && selectedEvent) {
                const enrolledClasses = [];
                const notEnrolledClasses = [];
                
                classes.forEach(cls => {
                    const hasEnrollment = all.some(e => e.classYear === cls && e.event === selectedEvent);
                    if (hasEnrollment) {
                        const count = all.filter(e => e.classYear === cls && e.event === selectedEvent).length;
                        enrolledClasses.push({name: cls, count: count});
                    } else {
                        notEnrolledClasses.push(cls);
                    }
                });
                
                html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">';
                
                // Classes with Enrollments
                html += '<div style="background:#d4edda;padding:15px;border-radius:6px;border:2px solid #28a745;">';
                html += '<h4 style="color:#155724;margin-bottom:10px;">‚úÖ Classes with Enrollments (' + enrolledClasses.length + ')</h4>';
                if (enrolledClasses.length > 0) {
                    html += '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
                    enrolledClasses.forEach(cls => {
                        html += '<span style="background:#28a745;color:white;padding:6px 12px;border-radius:20px;font-size:14px;font-weight:600;">' + cls.name + ' (' + cls.count + ')</span>';
                    });
                    html += '</div>';
                } else {
                    html += '<p style="color:#666;font-style:italic;margin:0;">No classes enrolled yet</p>';
                }
                html += '</div>';
                
                // Classes NOT Enrolled
                html += '<div style="background:#f8d7da;padding:15px;border-radius:6px;border:2px solid #dc3545;">';
                html += '<h4 style="color:#721c24;margin-bottom:10px;">‚ùå Classes NOT Enrolled (' + notEnrolledClasses.length + ')</h4>';
                if (notEnrolledClasses.length > 0) {
                    html += '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
                    notEnrolledClasses.forEach(cls => {
                        html += '<span style="background:#dc3545;color:white;padding:6px 12px;border-radius:20px;font-size:14px;font-weight:600;">' + cls + '</span>';
                    });
                    html += '</div>';
                } else {
                    html += '<p style="color:#666;font-style:italic;margin:0;">All classes have enrolled!</p>';
                }
                html += '</div>';
                html += '</div>';
            }
            
            // When Class is selected - show event enrollment status
            if (selectedClass && !selectedEvent) {
                const enrolledEvents = [];
                const pendingEvents = [];
                
                Object.keys(events).forEach(evt => {
                    const hasEnrollment = all.some(e => e.classYear === selectedClass && e.event === evt);
                    if (hasEnrollment) {
                        const count = all.filter(e => e.classYear === selectedClass && e.event === evt).length;
                        enrolledEvents.push({name: evt, count: count});
                    } else {
                        pendingEvents.push(evt);
                    }
                });
                
                html += '<h3 style="color:#2196F3;margin-bottom:15px;">üìä Summary for Class: <strong>' + selectedClass + '</strong></h3>';
                html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">';
                
                // Enrolled Events
                html += '<div style="background:white;padding:15px;border-radius:6px;">';
                html += '<h4 style="color:#4CAF50;margin-bottom:10px;">‚úÖ Enrolled Events (' + enrolledEvents.length + ')</h4>';
                if (enrolledEvents.length > 0) {
                    html += '<ul style="list-style:none;padding:0;margin:0;">';
                    enrolledEvents.forEach(evt => {
                        html += '<li style="padding:5px 0;border-bottom:1px solid #eee;">‚Ä¢ ' + evt.name + ' <span style="color:#666;">(' + evt.count + ' students)</span></li>';
                    });
                    html += '</ul>';
                } else {
                    html += '<p style="color:#999;font-style:italic;">No events enrolled yet</p>';
                }
                html += '</div>';
                
                // Pending Events
                html += '<div style="background:white;padding:15px;border-radius:6px;">';
                html += '<h4 style="color:#FF9800;margin-bottom:10px;">‚è≥ Pending Events (' + pendingEvents.length + ')</h4>';
                if (pendingEvents.length > 0) {
                    html += '<ul style="list-style:none;padding:0;margin:0;">';
                    pendingEvents.forEach(evt => {
                        html += '<li style="padding:5px 0;border-bottom:1px solid #eee;">‚Ä¢ ' + evt + '</li>';
                    });
                    html += '</ul>';
                } else {
                    html += '<p style="color:#999;font-style:italic;">All events completed!</p>';
                }
                html += '</div>';
                html += '</div>';
            }
            
            // When both Class and Event are selected
            if (selectedClass && selectedEvent) {
                const count = all.filter(e => e.classYear === selectedClass && e.event === selectedEvent).length;
                html += '<h3 style="color:#2196F3;margin-bottom:10px;">üìä Filtered View</h3>';
                html += '<p style="margin:0;"><strong>Class:</strong> ' + selectedClass + ' | <strong>Event:</strong> ' + selectedEvent + ' | <strong>Total Students:</strong> ' + count + '</p>';
            }
            
            summaryContent.innerHTML = html;
        }

        function updateEvents() {
            const cont = document.getElementById('eventsContainer');
            if (all.length===0) { cont.innerHTML = '<p style="text-align:center;padding:40px">No data</p>'; return; }
            let h = '';
            Object.keys(events).forEach(ev => {
                const evEnr = all.filter(e => e.event===ev);
                if (evEnr.length===0) return;
                h += '<div style="background:#f9f9f9;padding:20px;border-radius:8px;margin-bottom:20px"><h3 style="color:#c44569;margin-bottom:15px">'+ev+' ('+evEnr.length+')</h3>';
                classes.forEach(cl => {
                    const clEnr = evEnr.filter(e => e.classYear===cl);
                    if (clEnr.length===0) return;
                    h += '<div style="background:white;padding:15px;border-radius:6px;margin-bottom:15px"><h4 style="color:#6a1b9a;margin-bottom:10px">'+cl+' ('+clEnr.length+')</h4><div class="table-wrapper"><table><thead><tr><th>Sl</th><th>Name</th><th>Phone</th><th>Role</th><th>Details</th></tr></thead><tbody>';
                    clEnr.forEach((e,i) => h += '<tr><td>'+(i+1)+'</td><td>'+e.name+'</td><td>'+e.phone+'</td><td>'+e.role+'</td><td>'+getDet(e)+'</td></tr>');
                    h += '</tbody></table></div></div>';
                });
                h += '</div>';
            });
            cont.innerHTML = h;
        }

        function clearFilters() {
            document.getElementById('filterClass').value = '';
            document.getElementById('filterEvent').value = '';
            updateMaster();
        }

        function getDet(e) {
            const d = [];
            if (e.topic) d.push('Topic: '+e.topic);
            if (e.product) d.push('Product: '+e.product);
            if (e.cause) d.push('Cause: '+e.cause);
            if (e.languages) d.push('Languages: '+e.languages);
            if (e.showstopper) d.push('Showstopper: '+e.showstopper);
            return d.length>0 ? d.join('<br>') : '-';
        }

        function downloadMaster() {
            if (all.length===0) { alert('No data'); return; }
            let csv = 'Sl,Name,Phone,Class,Event,Role,Details\n';
            all.forEach((e,i) => csv += (i+1)+',"'+e.name+'","'+e.phone+'","'+e.classYear+'","'+e.event+'","'+e.role+'","'+getDet(e).replace(/<br>/g,' | ')+'"\n');
            download(csv,'youthfest_master.csv');
        }

        function downloadEvents() {
            if (all.length===0) { alert('No data'); return; }
            let csv = '';
            Object.keys(events).forEach(ev => {
                const evEnr = all.filter(e => e.event===ev);
                if (evEnr.length===0) return;
                csv += '\n'+ev+'\n';
                csv += 'Sl,Name,Phone,Class,Role,Details\n';
                let sl = 1;
                evEnr.forEach(e => { csv += sl+',"'+e.name+'","'+e.phone+'","'+e.classYear+'","'+e.role+'","'+getDet(e).replace(/<br>/g,' | ')+'"\n'; sl++; });
            });
            download(csv,'youthfest_events.csv');
        }

        function download(content,filename) {
            const blob = new Blob([content],{type:'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Jury Setup Functions (Super Admin Only)
        function loadEventSetup() {
            const event = document.getElementById('setupEventSelect').value;
            if (!event) {
                document.getElementById('eventSetupContainer').style.display = 'none';
                return;
            }
            
            document.getElementById('eventSetupContainer').style.display = 'block';
            
            // Load existing setup
            db.ref('jurySetup/'+event).once('value').then(snap => {
                const data = snap.val() || {};
                
                // Load jury names
                document.getElementById('jury1Name').value = data.jury1Name || '';
                document.getElementById('jury2Name').value = data.jury2Name || '';
                
                // Load jury passwords
                document.getElementById('jury1Password').value = data.jury1Password || '';
                document.getElementById('jury2Password').value = data.jury2Password || '';
                
                // Load criteria
                const criteria = data.criteria || [];
                renderCriteriaInputs(criteria);
            });
        }

        function renderCriteriaInputs(criteria) {
            const container = document.getElementById('criteriaContainer');
            container.innerHTML = '';
            
            if (criteria.length === 0) {
                criteria = ['', '', '', '', ''];  // Default 5 empty criteria
            }
            
            criteria.forEach((crit, index) => {
                const div = document.createElement('div');
                div.className = 'criteria-input-group';
                div.innerHTML = `
                    <label>Criterion ${index + 1}:</label>
                    <input type="text" class="criterion-input" data-index="${index}" value="${crit}" placeholder="e.g., Stage Presence, Creativity, Coordination">
                    ${criteria.length > 5 ? '<button class="remove-criteria-btn" onclick="removeCriterion('+index+')">Remove</button>' : ''}
                `;
                container.appendChild(div);
            });
        }

        function addCriterion() {
            const inputs = document.querySelectorAll('.criterion-input');
            const criteria = Array.from(inputs).map(inp => inp.value.trim());
            criteria.push('');
            renderCriteriaInputs(criteria);
        }

        function removeCriterion(index) {
            const inputs = document.querySelectorAll('.criterion-input');
            const criteria = Array.from(inputs).map(inp => inp.value.trim());
            if (criteria.length <= 5) {
                alert('Minimum 5 criteria required');
                return;
            }
            criteria.splice(index, 1);
            renderCriteriaInputs(criteria);
        }

        function saveEventSetup() {
            const event = document.getElementById('setupEventSelect').value;
            if (!event) return;
            
            const jury1Name = document.getElementById('jury1Name').value.trim();
            const jury2Name = document.getElementById('jury2Name').value.trim();
            const jury1Pwd = document.getElementById('jury1Password').value.trim();
            const jury2Pwd = document.getElementById('jury2Password').value.trim();
            
            if (!jury1Pwd || !jury2Pwd) {
                alert('Please set both jury passwords');
                return;
            }
            
            const inputs = document.querySelectorAll('.criterion-input');
            const criteria = Array.from(inputs).map(inp => inp.value.trim()).filter(c => c);
            
            if (criteria.length < 5) {
                alert('Please add at least 5 criteria');
                return;
            }
            
            const setupData = {
                jury1Name: jury1Name || 'Jury 1',
                jury2Name: jury2Name || 'Jury 2',
                jury1Password: jury1Pwd,
                jury2Password: jury2Pwd,
                criteria: criteria,
                resultsPublished: false
            };
            
            db.ref('jurySetup/'+event).set(setupData).then(() => {
                showSetupMessage('Setup saved successfully!', 'success');
            }).catch(err => {
                showSetupMessage('Error: '+err.message, 'error');
            });
        }

        function publishResults() {
            const event = document.getElementById('resultsEventSelect').value;
            if (!event) {
                alert('Please select an event first');
                return;
            }
            
            if (confirm('Publish results to all admins for '+event+'?')) {
                db.ref('jurySetup/'+event+'/resultsPublished').set(true).then(() => {
                    alert('‚úÖ Results published to admins for ' + event + '!');
                    // Show Results tab for all admins
                    updateResultsTabVisibility();
                });
            }
        }

        function unpublishResults() {
            const event = document.getElementById('resultsEventSelect').value;
            if (!event) {
                alert('Please select an event first');
                return;
            }
            
            if (confirm('Unpublish results for '+event+'?')) {
                db.ref('jurySetup/'+event+'/resultsPublished').set(false).then(() => {
                    alert('Results unpublished for ' + event);
                    // Check if any other results are published, hide tab if none
                    updateResultsTabVisibility();
                });
            }
        }

        function checkResultsPublished() {
            // For super admin, always show Results tab
            if (isSuperAdmin) {
                document.getElementById('resultsTab').style.display = 'block';
                return;
            }
            
            // For regular admin, check if any event has published results
            db.ref('jurySetup').once('value').then(snap => {
                let hasPublished = false;
                if (snap.exists()) {
                    snap.forEach(eventSnap => {
                        if (eventSnap.val().resultsPublished === true) {
                            hasPublished = true;
                        }
                    });
                }
                
                const resultsTab = document.getElementById('resultsTab');
                if (resultsTab) {
                    resultsTab.style.display = hasPublished ? 'block' : 'none';
                }
            });
        }
        
        function updateResultsTabVisibility() {
            // This is called after publish/unpublish to update tab visibility
            checkResultsPublished();
        }

        function showSetupMessage(msg, type) {
            const d = document.getElementById('setupMessage');
            d.className = 'message '+type+' show';
            d.textContent = (type === 'success' ? '‚úì ' : '‚úó ') + msg;
            setTimeout(() => d.classList.remove('show'), 5000);
        }

        // Jury Functions
        function loadJurySheet() {
            console.log('=== LOADING JURY SHEET ===');
            console.log('juryEvent:', juryEvent);
            console.log('Current all array length:', all.length);
            console.log('Firebase ref path:', ref.toString());
            
            // Show loading message
            document.getElementById('jurySheetContainer').innerHTML = '<p style="text-align:center;padding:40px;color:#666;">Loading enrollments...</p>';
            
            // First ensure we have the latest enrollment data
            console.log('Fetching from Firebase...');
            ref.once('value').then(snap => {
                console.log('Firebase snapshot received');
                console.log('Snapshot exists:', snap.exists());
                console.log('Snapshot numChildren:', snap.numChildren());
                
                all = [];
                if (snap.exists()) {
                    let count = 0;
                    snap.forEach(child => {
                        count++;
                        const enrollment = {id: child.key, ...child.val()};
                        all.push(enrollment);
                        if (count <= 5) {
                            console.log('Enrollment ' + count + ':', enrollment);
                        }
                    });
                    console.log('Total enrollments loaded:', count);
                } else {
                    console.log('No enrollments found in Firebase!');
                }
                
                console.log('Loaded enrollments, all array length:', all.length);
                console.log('First 3 enrollments:', all.slice(0, 3));
                
                // Filter for current event
                const eventEnrollments = all.filter(e => {
                    console.log('Checking enrollment:', e.event, '===', juryEvent, '?', e.event === juryEvent);
                    return e.event === juryEvent;
                });
                console.log('Enrollments for event "' + juryEvent + '":', eventEnrollments.length);
                console.log('Event enrollments:', eventEnrollments);
                
                // Now get jury setup
                return db.ref('jurySetup/'+juryEvent).once('value');
            }).then(snap => {
                const setup = snap.val();
                console.log('Jury setup:', setup);
                
                if (!setup || !setup.criteria) {
                    document.getElementById('jurySheetContainer').innerHTML = '<p style="text-align:center;padding:40px;color:#999">Event setup not complete. Contact super admin.</p>';
                    return;
                }
                
                // Get enrolled classes for this event
                const enrolledClasses = [...new Set(all.filter(e => e.event === juryEvent).map(e => e.classYear))];
                
                console.log('Enrolled classes for', juryEvent, ':', enrolledClasses);
                console.log('Total classes found:', enrolledClasses.length);
                
                if (enrolledClasses.length === 0) {
                    let debugInfo = '<p style="text-align:center;padding:40px;">';
                    debugInfo += '<strong style="color:#f44336;">No classes enrolled for this event yet.</strong><br><br>';
                    debugInfo += '<span style="color:#666;">Event: ' + juryEvent + '<br>';
                    debugInfo += 'Total enrollments in database: ' + all.length + '<br>';
                    debugInfo += 'Enrollments for this event: ' + all.filter(e => e.event === juryEvent).length + '</span><br><br>';
                    debugInfo += '<button class="btn btn-info" onclick="showEnrollmentDebug()">üîç Debug Enrollments</button>';
                    debugInfo += '</p>';
                    document.getElementById('jurySheetContainer').innerHTML = debugInfo;
                    return;
                }
                
                renderJurySheet(enrolledClasses, setup.criteria);
                loadExistingMarks();
            }).catch(err => {
                console.error('Error loading jury sheet:', err);
                document.getElementById('jurySheetContainer').innerHTML = '<p style="text-align:center;padding:40px;color:red;">Error loading jury sheet: ' + err.message + '</p>';
            });
        }

        function renderJurySheet(enrolledClasses, criteria) {
            let html = '<div class="table-wrapper"><div class="marks-table"><table><thead><tr>';
            html += '<th>Class</th><th>Theme/Topic</th>';
            criteria.forEach((crit, i) => {
                html += '<th>'+crit+'<br><small>(10 marks)</small></th>';
            });
            html += '<th>Total</th></tr></thead><tbody>';
            
            enrolledClasses.forEach(cls => {
                const classEnrollments = all.filter(e => e.event === juryEvent && e.classYear === cls);
                const theme = classEnrollments.length > 0 ? getDet(classEnrollments[0]) : '-';
                
                html += '<tr><td><strong>'+cls+'</strong></td><td>'+theme+'</td>';
                criteria.forEach((crit, i) => {
                    html += '<td><input type="number" class="marks-input" data-class="'+cls+'" data-criterion="'+i+'" min="0" max="10" step="0.5" placeholder="0-10"></td>';
                });
                html += '<td class="total-marks" id="total-'+cls.replace(/\s+/g, '-')+'">0</td></tr>';
            });
            
            html += '</tbody></table></div></div>';
            
            document.getElementById('jurySheetContainer').innerHTML = html;
            
            // Add event listeners for auto-calculation
            document.querySelectorAll('.marks-input').forEach(inp => {
                inp.addEventListener('input', function() {
                    const cls = this.dataset.class;
                    calculateTotal(cls);
                });
            });
        }

        function loadExistingMarks() {
            const dbPath = 'juryMarks/' + juryEvent + '/jury' + juryNumber;
            console.log('=== LOADING EXISTING MARKS ===');
            console.log('Loading marks from:', dbPath);
            console.log('juryEvent:', juryEvent);
            console.log('juryNumber:', juryNumber);
            
            db.ref(dbPath).once('value').then(snap => {
                const marks = snap.val();
                console.log('Loaded marks data:', JSON.stringify(marks, null, 2));
                
                if (!marks) {
                    console.log('No existing marks found');
                    return;
                }
                
                // Check if this is test data (has 'test' property instead of class data)
                if (marks.test !== undefined) {
                    console.warn('‚ö†Ô∏è TEST DATA DETECTED in database!');
                    console.warn('Path contains test data instead of actual marks');
                    console.warn('You should clear this test data from Firebase Console');
                    showJuryMessage('Warning: Test data found in database. Clear it before saving real marks.', 'error');
                    return;
                }
                
                // Check what's in the database
                console.log('Database keys:', Object.keys(marks));
                
                // Check what inputs are available
                const allInputs = document.querySelectorAll('.marks-input');
                console.log('Total inputs found:', allInputs.length);
                allInputs.forEach(inp => {
                    console.log('Input found - class:', inp.dataset.class, 'criterion:', inp.dataset.criterion);
                });
                
                let marksLoaded = 0;
                
                Object.keys(marks).forEach(sanitizedCls => {
                    console.log('Processing class from database:', sanitizedCls);
                    
                    if (marks[sanitizedCls] && marks[sanitizedCls].marks && Array.isArray(marks[sanitizedCls].marks)) {
                        console.log('Marks array for', sanitizedCls, ':', marks[sanitizedCls].marks);
                        
                        // Get the original class name if available, otherwise use the sanitized one
                        const originalCls = marks[sanitizedCls].originalClassName || sanitizedCls;
                        console.log('Original class name:', originalCls);
                        
                        marks[sanitizedCls].marks.forEach((mark, i) => {
                            // Try to find input using original class name first
                            let selector = '.marks-input[data-class="'+originalCls+'"][data-criterion="'+i+'"]';
                            let inp = document.querySelector(selector);
                            
                            // If not found, try sanitized class name
                            if (!inp) {
                                selector = '.marks-input[data-class="'+sanitizedCls+'"][data-criterion="'+i+'"]';
                                inp = document.querySelector(selector);
                            }
                            
                            console.log('Looking for input with selector:', selector);
                            
                            if (inp) {
                                inp.value = mark;
                                marksLoaded++;
                                console.log('‚úì Set mark for', originalCls, 'criterion', i, ':', mark);
                            } else {
                                console.warn('‚úó Input NOT found for class:', originalCls, '(sanitized:', sanitizedCls, ') criterion:', i);
                            }
                        });
                        calculateTotal(originalCls);
                    } else {
                        console.warn('Invalid marks structure for class:', sanitizedCls, marks[sanitizedCls]);
                    }
                });
                
                if (marksLoaded > 0) {
                    showJuryMessage('Previous marks loaded successfully ('+marksLoaded+' marks)', 'success');
                } else {
                    showJuryMessage('No previous marks found to load', 'error');
                }
            }).catch(err => {
                console.error('Error loading marks:', err);
                showJuryMessage('Error loading marks: ' + err.message, 'error');
            });
        }

        function calculateTotal(cls) {
            const inputs = document.querySelectorAll('.marks-input[data-class="'+cls+'"]');
            let total = 0;
            inputs.forEach(inp => {
                const val = parseFloat(inp.value) || 0;
                total += val;
            });
            const totalCell = document.getElementById('total-'+cls.replace(/\s+/g, '-'));
            if (totalCell) totalCell.textContent = total.toFixed(1);
        }

        function sanitizeKey(key) {
            // Replace characters that Firebase doesn't allow in keys
            // . $ # [ ] / and control characters
            return key.replace(/[.#$\[\]\/]/g, '_');
        }

        function saveMarks() {
            console.log('=== SAVE MARKS STARTED ===');
            console.log('juryEvent:', juryEvent);
            console.log('juryNumber:', juryNumber);
            console.log('Database connected:', isConnected);
            
            if (!juryEvent || !juryNumber) {
                alert('Error: Jury session not initialized. Please log in again.');
                return;
            }
            
            if (!isConnected) {
                alert('Error: Not connected to Firebase database. Please check your internet connection.');
                return;
            }
            
            const marksData = {};
            let inputCount = 0;
            
            // First, organize marks by class
            document.querySelectorAll('.marks-input').forEach(inp => {
                inputCount++;
                const cls = inp.dataset.class;
                const sanitizedCls = sanitizeKey(cls); // Sanitize class name for Firebase
                const critIndex = parseInt(inp.dataset.criterion);
                const val = parseFloat(inp.value) || 0;
                
                if (!marksData[sanitizedCls]) {
                    marksData[sanitizedCls] = { 
                        marks: {}, 
                        completed: false,
                        originalClassName: cls // Store original name
                    };
                }
                marksData[sanitizedCls].marks[critIndex] = val;
            });
            
            // Convert marks object to array to ensure proper structure
            Object.keys(marksData).forEach(cls => {
                const marksObj = marksData[cls].marks;
                const marksArray = [];
                const maxIndex = Math.max(...Object.keys(marksObj).map(k => parseInt(k)));
                
                // Fill array with all marks
                for (let i = 0; i <= maxIndex; i++) {
                    marksArray[i] = marksObj[i] !== undefined ? marksObj[i] : 0;
                }
                
                marksData[cls].marks = marksArray;
            });
            
            console.log('Marks inputs found:', inputCount);
            console.log('Marks data to save:', JSON.stringify(marksData, null, 2));
            
            if (inputCount === 0) {
                alert('No marks data found. Please refresh the page and try again.');
                return;
            }
            
            // Show saving indicator
            showJuryMessage('Saving marks...', 'success');
            
            // Use raw event name (do not encode)
            const dbPath = 'juryMarks/' + juryEvent + '/jury' + juryNumber;
            console.log('Event name:', juryEvent);
            console.log('Saving to Firebase path:', dbPath);
            console.log('Full database URL:', db.ref(dbPath).toString());
            
            // CRITICAL FIX: First check if there's test data and clear it
            db.ref(dbPath).once('value').then(snap => {
                const existingData = snap.val();
                
                // Check if test data exists
                if (existingData && existingData.test !== undefined) {
                    console.warn('‚ö†Ô∏è Test data detected! Clearing before save...');
                    showJuryMessage('Clearing test data...', 'success');
                    // First delete the entire node to clear test data
                    return db.ref(dbPath).remove();
                }
                
                return Promise.resolve();
            }).then(() => {
                console.log('Now saving actual marks data...');
                // Now save the actual marks data
                return db.ref(dbPath).set(marksData);
            }).then(() => {
                console.log('‚úì Firebase .set() resolved successfully');
                
                // Immediately verify the save
                return db.ref(dbPath).once('value');
            }).then(snap => {
                const savedData = snap.val();
                console.log('‚úì Verification read successful');
                console.log('Data in database:', JSON.stringify(savedData, null, 2));
                
                if (savedData && savedData.test === undefined) {
                    // Check that we have actual class data, not test data
                    const hasRealData = Object.keys(savedData).some(key => 
                        savedData[key] && savedData[key].marks && Array.isArray(savedData[key].marks)
                    );
                    
                    if (hasRealData) {
                        showJuryMessage('Marks saved successfully!', 'success');
                        alert('‚úÖ SUCCESS!\n\nMarks saved and verified in database.\n\n' + 
                              'Classes saved: ' + Object.keys(savedData).length + '\n\n' +
                              'Path: juryMarks/' + juryEvent + '/jury' + juryNumber);
                    } else {
                        console.error('‚úó VERIFICATION FAILED: Data saved but structure is wrong');
                        showJuryMessage('Warning: Data saved but structure may be incorrect', 'error');
                    }
                } else if (savedData && savedData.test !== undefined) {
                    console.error('‚úó TEST DATA STILL EXISTS after save attempt');
                    showJuryMessage('Error: Test data blocking saves. Please clear manually.', 'error');
                    alert('‚ö†Ô∏è TEST DATA PROBLEM!\n\nTest data is still in the database.\n\n' +
                          'Please manually delete from Firebase Console:\n' +
                          'juryMarks > Solo Dance > jury1 > test');
                } else {
                    console.error('‚úó VERIFICATION FAILED: Data is null after save');
                    showJuryMessage('Warning: Save completed but verification failed', 'error');
                    alert('‚ö†Ô∏è WARNING!\n\nSave appeared successful but data could not be verified.\n\n' +
                          'Possible issue: Firebase security rules may be blocking reads.\n\n' +
                          'Please check Firebase Console > Realtime Database > Rules');
                }
            }).catch(err => {
                console.error('‚úó FIREBASE ERROR:', err);
                console.error('Error code:', err.code);
                console.error('Error message:', err.message);
                
                let errorMsg = '‚ùå SAVE FAILED!\n\n';
                
                if (err.code === 'PERMISSION_DENIED' || err.message.includes('permission')) {
                    errorMsg += 'ERROR: Permission Denied\n\n';
                    errorMsg += 'Firebase security rules are blocking the save.\n\n';
                    errorMsg += 'SOLUTION:\n';
                    errorMsg += '1. Go to Firebase Console\n';
                    errorMsg += '2. Realtime Database > Rules\n';
                    errorMsg += '3. Set rules to allow writes\n\n';
                    errorMsg += 'See browser console for details.';
                    
                    console.log('%c FIREBASE RULES FIX NEEDED ', 'background: red; color: white; font-size: 16px; font-weight: bold;');
                    console.log('Your current Firebase rules are blocking writes to: ' + dbPath);
                    console.log('\nTo fix this, update your Firebase Realtime Database Rules to:');
                    console.log('{\n  "rules": {\n    ".read": true,\n    ".write": true\n  }\n}');
                    console.log('\nOR for better security:');
                    console.log('{\n  "rules": {\n    "juryMarks": {\n      ".read": true,\n      ".write": true\n    },\n    "jurySetup": {\n      ".read": true,\n      ".write": true\n    },\n    "youthfest-enrollments": {\n      ".read": true,\n      ".write": true\n    }\n  }\n}');
                } else {
                    errorMsg += 'Error: ' + err.message + '\n\n';
                        errorMsg += 'Code: ' + err.code + '\n\n';
                        errorMsg += 'Check browser console for details.';
                    }
                    
                    showJuryMessage('Error: ' + err.message, 'error');
                    alert(errorMsg);
                });
        }

        function markAsCompleted() {
            if (!confirm('Mark evaluation as completed? You can still edit marks later.')) return;
            
            const marksData = {};
            
            // First, organize marks by class
            document.querySelectorAll('.marks-input').forEach(inp => {
                const cls = inp.dataset.class;
                const sanitizedCls = sanitizeKey(cls); // Sanitize class name
                const critIndex = parseInt(inp.dataset.criterion);
                const val = parseFloat(inp.value) || 0;
                
                if (!marksData[sanitizedCls]) {
                    marksData[sanitizedCls] = { 
                        marks: {}, 
                        completed: true,
                        originalClassName: cls
                    };
                }
                marksData[sanitizedCls].marks[critIndex] = val;
            });
            
            // Convert marks object to array to ensure proper structure
            Object.keys(marksData).forEach(cls => {
                const marksObj = marksData[cls].marks;
                const marksArray = [];
                const maxIndex = Math.max(...Object.keys(marksObj).map(k => parseInt(k)));
                
                // Fill array with all marks
                for (let i = 0; i <= maxIndex; i++) {
                    marksArray[i] = marksObj[i] !== undefined ? marksObj[i] : 0;
                }
                
                marksData[cls].marks = marksArray;
            });
            
            const dbPath = 'juryMarks/' + juryEvent + '/jury' + juryNumber;
            
            db.ref(dbPath).set(marksData).then(() => {
                showJuryMessage('Evaluation marked as completed!', 'success');
                alert('‚úÖ Evaluation marked as completed!\n\nYour marks are now final.');
            }).catch(err => {
                showJuryMessage('Error: '+err.message, 'error');
                alert('‚ùå Error: '+err.message);
            });
        }

        function showJuryMessage(msg, type) {
            const d = document.getElementById('juryMessage');
            d.className = 'message '+type+' show';
            d.textContent = (type === 'success' ? '‚úì ' : '‚úó ') + msg;
            setTimeout(() => d.classList.remove('show'), 5000);
            scroll(0,0);
        }

        // Results Functions
        function loadResultsTab() {
            // Populate event select for results
            const sel = document.getElementById('resultsEventSelect');
            sel.innerHTML = '<option value="">-- Select Event --</option>';
            
            db.ref('jurySetup').once('value').then(snap => {
                if (!snap.exists()) return;
                
                snap.forEach(child => {
                    const event = child.key;
                    const setup = child.val();
                    
                    // For super admin, show all events
                    // For admin, show only published events
                    if (isSuperAdmin || setup.resultsPublished) {
                        const opt = document.createElement('option');
                        opt.value = event;
                        opt.textContent = event + (setup.resultsPublished ? ' ‚úì' : '');
                        sel.appendChild(opt);
                    }
                });
            });
        }

        function loadEventResults() {
            const event = document.getElementById('resultsEventSelect').value;
            console.log('Loading results for event:', event);
            
            if (!event) {
                document.getElementById('resultsContainer').innerHTML = '';
                return;
            }
            
            // Load jury setup to get names and publication status
            db.ref('jurySetup/'+event).once('value').then(setupSnap => {
                const setup = setupSnap.val() || {};
                console.log('Results published status:', setup.resultsPublished);
                
                if (!isSuperAdmin && !setup.resultsPublished) {
                    document.getElementById('resultsContainer').innerHTML = '<p style="text-align:center;padding:40px;color:#999">Results not yet published by super admin.</p>';
                    return;
                }
                
                const jury1Name = setup.jury1Name || 'Jury 1';
                const jury2Name = setup.jury2Name || 'Jury 2';
                
                // Load marks from both juries using raw event name
                console.log('Loading marks from both juries...');
                Promise.all([
                    db.ref('juryMarks/'+event+'/jury1').once('value'),
                    db.ref('juryMarks/'+event+'/jury2').once('value')
                ]).then(([jury1Snap, jury2Snap]) => {
                    const jury1Marks = jury1Snap.val() || {};
                    const jury2Marks = jury2Snap.val() || {};
                    
                    console.log('Jury 1 Marks:', jury1Marks);
                    console.log('Jury 2 Marks:', jury2Marks);
                    
                    displayResults(event, jury1Marks, jury2Marks, jury1Name, jury2Name);
                });
            });
        }

        function displayResults(event, jury1Marks, jury2Marks, jury1Name, jury2Name) {
            // Default names if not provided
            jury1Name = jury1Name || 'Jury 1';
            jury2Name = jury2Name || 'Jury 2';
            
            console.log('=== DISPLAY RESULTS DEBUG ===');
            console.log('Jury 1 Marks:', jury1Marks);
            console.log('Jury 2 Marks:', jury2Marks);
            
            const allClasses = new Set([...Object.keys(jury1Marks), ...Object.keys(jury2Marks)]);
            
            if (allClasses.size === 0) {
                document.getElementById('resultsContainer').innerHTML = '<p style="text-align:center;padding:40px;color:#999">No marks submitted yet.</p>';
                return;
            }
            
            // Calculate totals and averages
            const results = [];
            allClasses.forEach(sanitizedCls => {
                const j1 = jury1Marks[sanitizedCls];
                const j2 = jury2Marks[sanitizedCls];
                
                console.log('Class:', sanitizedCls);
                console.log('  Jury1 data:', j1);
                console.log('  Jury1 completed?:', j1 && j1.completed);
                console.log('  Jury2 data:', j2);
                console.log('  Jury2 completed?:', j2 && j2.completed);
                
                // Get original class name if available
                const displayCls = (j1 && j1.originalClassName) || 
                                  (j2 && j2.originalClassName) || 
                                  sanitizedCls;
                
                let j1Total = 0;
                let j2Total = 0;
                
                if (j1 && j1.marks) {
                    j1Total = j1.marks.reduce((sum, m) => sum + (m || 0), 0);
                }
                if (j2 && j2.marks) {
                    j2Total = j2.marks.reduce((sum, m) => sum + (m || 0), 0);
                }
                
                const avgTotal = (j1Total + j2Total) / 2;
                
                results.push({
                    class: displayCls,  // Use original name for display
                    jury1Total: j1Total,
                    jury2Total: j2Total,
                    average: avgTotal,
                    jury1Completed: j1 && j1.completed,
                    jury2Completed: j2 && j2.completed
                });
            });
            
            // Sort by average (descending)
            results.sort((a, b) => b.average - a.average);
            
            // Display results
            let html = '<h3 style="color:#c44569;margin-bottom:20px">Results for '+event+'</h3>';
            
            // Show marks detail only for super admin and jury
            if (isSuperAdmin || isJury) {
                html += '<div class="table-wrapper"><table><thead><tr><th>Rank</th><th>Class</th><th>'+jury1Name+' Total</th><th>'+jury2Name+' Total</th><th>Average</th><th>Status</th></tr></thead><tbody>';
                
                results.forEach((r, i) => {
                    const rank = i + 1;
                    const badge = rank === 1 ? '<span class="winner-badge">üèÜ Winner</span>' : 
                                 rank === 2 ? '<span class="runner-badge">ü•à Runner Up</span>' : '';
                    
                    html += '<tr class="rank-'+(rank <= 3 ? rank : '')+'">';
                    html += '<td><strong>'+rank+'</strong></td>';
                    html += '<td><strong>'+r.class+'</strong> '+badge+'</td>';
                    html += '<td>'+r.jury1Total.toFixed(1)+(r.jury1Completed ? ' ‚úì' : '')+'</td>';
                    html += '<td>'+r.jury2Total.toFixed(1)+(r.jury2Completed ? ' ‚úì' : '')+'</td>';
                    html += '<td><strong>'+r.average.toFixed(1)+'</strong></td>';
                    html += '<td>'+(r.jury1Completed && r.jury2Completed ? '‚úÖ Complete' : '‚è≥ In Progress')+'</td>';
                    html += '</tr>';
                });
                
                html += '</tbody></table></div>';
            } else {
                // For regular admins, show only final results (no marks)
                results.forEach((r, i) => {
                    const rank = i + 1;
                    html += '<div class="results-card rank-'+rank+'">';
                    html += '<h3 style="color:#c44569;">Rank '+rank+': '+r.class;
                    if (rank === 1) html += ' <span class="winner-badge">üèÜ Winner</span>';
                    if (rank === 2) html += ' <span class="runner-badge">ü•à Runner Up</span>';
                    html += '</h3>';
                    html += '<p style="color:#666;margin-top:10px">Final Score: <strong>'+r.average.toFixed(1)+'</strong></p>';
                    html += '</div>';
                });
            }
            
            document.getElementById('resultsContainer').innerHTML = html;
        }

        function clearTestData() {
            if (!confirm('Clear test data from Firebase?\n\nThis will ONLY delete:\n- juryMarks/TEST/*\n\nYour actual marks will NOT be affected.')) {
                return;
            }
            
            console.log('=== CLEARING TEST DATA ===');
            
            // Only clear the TEST node - DO NOT touch the actual jury path
            db.ref('juryMarks/TEST').remove()
            .then(() => {
                console.log('‚úì Test data cleared');
                showJuryMessage('Test data cleared successfully! Your actual marks are safe.', 'success');
                alert('‚úÖ Test data cleared!\n\nYour actual marks are safe and untouched.');
            }).catch(err => {
                console.error('Error clearing test data:', err);
                showJuryMessage('Error clearing test data: ' + err.message, 'error');
            });
        }

        function debugLoadMarks() {
            console.log('=== DEBUG LOAD MARKS ===');
            console.log('juryEvent:', juryEvent);
            console.log('juryNumber:', juryNumber);
            
            const dbPath = 'juryMarks/' + juryEvent + '/jury' + juryNumber;
            console.log('Database path:', dbPath);
            
            // First check what's in the database
            db.ref(dbPath).once('value').then(snap => {
                const data = snap.val();
                console.log('Raw database data:', data);
                console.log('Data as JSON:', JSON.stringify(data, null, 2));
                
                // Check all inputs on the page
                const inputs = document.querySelectorAll('.marks-input');
                console.log('Total inputs on page:', inputs.length);
                
                const inputDetails = [];
                inputs.forEach((inp, idx) => {
                    inputDetails.push({
                        index: idx,
                        class: inp.dataset.class,
                        criterion: inp.dataset.criterion,
                        value: inp.value
                    });
                });
                console.table(inputDetails);
                
                // Show a detailed report
                let report = '=== DEBUG REPORT ===\n\n';
                report += 'Database Path: ' + dbPath + '\n\n';
                report += 'Database Content:\n' + JSON.stringify(data, null, 2) + '\n\n';
                report += 'Total Inputs Found: ' + inputs.length + '\n\n';
                report += 'Input Details:\n';
                inputDetails.forEach(inp => {
                    report += `  [${inp.index}] Class: "${inp.class}", Criterion: ${inp.criterion}, Value: ${inp.value}\n`;
                });
                
                console.log(report);
                alert(report);
                
            }).catch(err => {
                console.error('Debug load error:', err);
                alert('Debug load failed: ' + err.message);
            });
        }

        function showEnrollmentDebug() {
            console.log('=== ENROLLMENT DEBUG ===');
            console.log('Current juryEvent:', juryEvent);
            console.log('All array length:', all.length);
            console.log('All enrollments:', all);
            
            // Filter for current event
            const eventEnrollments = all.filter(e => e.event === juryEvent);
            console.log('Enrollments for', juryEvent, ':', eventEnrollments);
            
            // Get unique classes
            const classes = [...new Set(eventEnrollments.map(e => e.classYear))];
            console.log('Unique classes:', classes);
            
            // Build report
            let report = '=== ENROLLMENT DEBUG REPORT ===\n\n';
            report += 'Event: ' + juryEvent + '\n';
            report += 'Total enrollments in database: ' + all.length + '\n';
            report += 'Enrollments for this event: ' + eventEnrollments.length + '\n';
            report += 'Unique classes: ' + classes.join(', ') + '\n\n';
            
            report += 'Detailed Enrollments:\n';
            eventEnrollments.forEach((e, i) => {
                report += `${i+1}. Class: ${e.classYear}, Name: ${e.name}, Phone: ${e.phone}\n`;
            });
            
            if (eventEnrollments.length === 0) {
                report += '\n‚ö†Ô∏è NO ENROLLMENTS FOUND!\n';
                report += 'This means either:\n';
                report += '1. No one has enrolled for this event yet\n';
                report += '2. The enrollments are not being loaded from Firebase\n';
                report += '3. The event name doesn\'t match\n';
            }
            
            console.log(report);
            alert(report);
        }

        function testFirebaseWrite() {
            console.log('=== TESTING FIREBASE WRITE ===');
            console.log('Testing write to: juryMarks/TEST/test');
            
            const testData = {
                timestamp: new Date().toISOString(),
                message: 'This is a test write',
                juryEvent: juryEvent,
                juryNumber: juryNumber
            };
            
            console.log('Test data:', testData);
            
            // Test 1: Try writing to test path
            db.ref('juryMarks/TEST/test').set(testData)
                .then(() => {
                    console.log('‚úì TEST WRITE SUCCESSFUL');
                    
                    // Verify by reading back
                    return db.ref('juryMarks/TEST/test').once('value');
                })
                .then(snap => {
                    const readData = snap.val();
                    console.log('‚úì TEST READ SUCCESSFUL');
                    console.log('Data read back:', readData);
                    
                    if (readData) {
                        alert('‚úÖ FIREBASE TEST PASSED!\n\n' +
                              'Firebase is working correctly.\n' +
                              'Write: SUCCESS\n' +
                              'Read: SUCCESS\n\n' +
                              'Check Firebase Console - you should see:\n' +
                              'juryMarks > TEST > test\n\n' +
                              'The issue must be in the saveMarks function.');
                              
                        // Now test the actual save path
                        console.log('Now testing actual save path...');
                        const actualPath = 'juryMarks/' + juryEvent + '/jury' + juryNumber;
                        console.log('Actual path:', actualPath);
                        
                        return db.ref(actualPath).set({test: 'actual path test'});
                    } else {
                        throw new Error('Read returned null');
                    }
                })
                .then(() => {
                    console.log('‚úì ACTUAL PATH WRITE SUCCESSFUL');
                    alert('‚úÖ Both tests passed! Check the console and Firebase database.');
                })
                .catch(err => {
                    console.error('‚úó TEST FAILED:', err);
                    console.error('Error code:', err.code);
                    console.error('Error message:', err.message);
                    
                    alert('‚ùå FIREBASE TEST FAILED!\n\n' +
                          'Error: ' + err.message + '\n' +
                          'Code: ' + err.code + '\n\n' +
                          'This means Firebase rules may still be blocking writes.\n' +
                          'Check browser console for details.');
                });
        }

        // Edit and Delete Functions
        let editingKey = null;
        let editingData = null;

        // Wrapper functions to handle calls from data attributes
        function editEnrollmentByKey(key) {
            editEnrollment(key);
        }

        function deleteEnrollmentByKey(key, name, event) {
            deleteEnrollment(key, name, event);
        }

        function editEnrollment(key) {
            console.log('Editing enrollment:', key);
            console.log('All enrollments:', all);
            console.log('Looking for key:', key);
            
            editingKey = key;
            
            // Find the enrollment data - search by id field
            const enrollment = all.find(e => e.id === key);
            
            if (!enrollment) {
                console.error('Enrollment not found!');
                console.log('Available IDs:', all.map(e => e.id));
                alert('Error: Enrollment not found. Please refresh the page and try again.');
                return;
            }
            
            editingData = enrollment;
            console.log('Enrollment data:', enrollment);
            
            // Build edit form based on event type
            const eventConfig = events[enrollment.event];
            const isTeamEvent = eventConfig && eventConfig.count > 1;
            
            let formHtml = '<div class="form-group">';
            formHtml += '<label>Name:</label>';
            formHtml += '<input type="text" id="editName" value="' + enrollment.name + '" required>';
            formHtml += '</div>';
            
            formHtml += '<div class="form-group">';
            formHtml += '<label>Phone:</label>';
            formHtml += '<input type="tel" id="editPhone" value="' + enrollment.phone + '" required>';
            formHtml += '</div>';
            
            formHtml += '<div class="form-group">';
            formHtml += '<label>Class Year:</label>';
            formHtml += '<input type="text" id="editClass" value="' + enrollment.classYear + '" readonly>';
            formHtml += '</div>';
            
            formHtml += '<div class="form-group">';
            formHtml += '<label>Event:</label>';
            formHtml += '<input type="text" value="' + enrollment.event + '" readonly>';
            formHtml += '</div>';
            
            formHtml += '<div class="form-group">';
            formHtml += '<label>Role:</label>';
            formHtml += '<input type="text" value="' + enrollment.role + '" readonly>';
            formHtml += '</div>';
            
            // Add team members if it's a team event
            if (isTeamEvent && enrollment.teamMembers) {
                for (let i = 0; i < enrollment.teamMembers.length; i++) {
                    const member = enrollment.teamMembers[i];
                    formHtml += '<div class="team-member-box">';
                    formHtml += '<div class="member-header">Team Member ' + (i + 1) + '</div>';
                    formHtml += '<div class="form-group">';
                    formHtml += '<label>Name:</label>';
                    formHtml += '<input type="text" id="editTeamName' + i + '" value="' + member.name + '" required>';
                    formHtml += '</div>';
                    formHtml += '<div class="form-group">';
                    formHtml += '<label>Phone:</label>';
                    formHtml += '<input type="tel" id="editTeamPhone' + i + '" value="' + member.phone + '" required>';
                    formHtml += '</div>';
                    formHtml += '</div>';
                }
            }
            
            document.getElementById('editFormContainer').innerHTML = formHtml;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingKey = null;
            editingData = null;
        }

        function saveEdit() {
            if (!editingKey || !editingData) {
                alert('Error: No enrollment selected');
                return;
            }
            
            // Get updated values
            const updatedName = document.getElementById('editName').value.trim();
            const updatedPhone = document.getElementById('editPhone').value.trim();
            
            if (!updatedName || !updatedPhone) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Validate phone
            if (!/^\d{10}$/.test(updatedPhone)) {
                alert('Please enter a valid 10-digit phone number');
                return;
            }
            
            // Build updated enrollment object
            const updatedEnrollment = {
                ...editingData,
                name: updatedName,
                phone: updatedPhone
            };
            
            // Update team members if applicable
            const eventConfig = events[editingData.event];
            if (eventConfig && eventConfig.count > 1 && editingData.teamMembers) {
                updatedEnrollment.teamMembers = [];
                for (let i = 0; i < editingData.teamMembers.length; i++) {
                    const memberName = document.getElementById('editTeamName' + i).value.trim();
                    const memberPhone = document.getElementById('editTeamPhone' + i).value.trim();
                    
                    if (!memberName || !memberPhone) {
                        alert('Please fill in all team member details');
                        return;
                    }
                    
                    if (!/^\d{10}$/.test(memberPhone)) {
                        alert('Please enter valid 10-digit phone numbers for all team members');
                        return;
                    }
                    
                    updatedEnrollment.teamMembers.push({
                        name: memberName,
                        phone: memberPhone
                    });
                }
            }
            
            // Save to Firebase
            ref.child(editingKey).set(updatedEnrollment)
                .then(() => {
                    showOk('Enrollment updated successfully!');
                    closeEditModal();
                    loadData(); // Reload data
                    
                    // Refresh the appropriate view
                    if (studentClass) {
                        viewStudentClassEnrollments();
                    }
                    if (isCR) {
                        updateCRView();
                    }
                })
                .catch(err => {
                    console.error('Error updating enrollment:', err);
                    showErr('Failed to update enrollment: ' + err.message);
                });
        }

        function deleteEnrollment(key, name, event) {
            // Find the enrollment data - search by id field
            const enrollment = all.find(e => e.id === key);
            if (!enrollment) {
                alert('Error: Enrollment not found');
                return;
            }
            
            if (!confirm('Are you sure you want to delete the enrollment for ' + name + ' in ' + event + '?')) {
                return;
            }
            
            ref.child(key).remove()
                .then(() => {
                    showOk('Enrollment deleted successfully!');
                    loadData(); // Reload data
                    
                    // Refresh the appropriate view
                    if (studentClass) {
                        viewStudentClassEnrollments();
                    }
                    if (isCR) {
                        updateCRView();
                    }
                })
                .catch(err => {
                    console.error('Error deleting enrollment:', err);
                    showErr('Failed to delete enrollment: ' + err.message);
                });
        }

        function showOk(msg) {
            const d = document.getElementById('enrollMessage');
            d.className = 'message success show';
            d.textContent = '‚úì '+msg;
            setTimeout(() => d.classList.remove('show'), 5000);
            scroll(0,0);
        }

        function showErr(msg) {
            const d = document.getElementById('enrollMessage');
            d.className = 'message error show';
            d.textContent = '‚úó '+msg;
            setTimeout(() => d.classList.remove('show'), 5000);
            scroll(0,0);
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) event.target.style.display = 'none';
        }
    </script>
    
    <!-- ============================================ -->
    <!-- RULES AND REGULATIONS SECTION                -->
    <!-- TO EDIT: Just change the text below          -->
    <!-- TO ADD PDF: Replace "rules.pdf" with your    -->
    <!-- PDF file name and upload it to same folder   -->
    <!-- ============================================ -->
    <div class="content" style="margin-bottom:30px;margin-top:40px;padding:40px 30px;">
        <div style="text-align:center;margin-bottom:30px;">
            <h2 style="color:#c44569;margin-bottom:20px;">üìã General Rules and Regulations</h2>
            
            <!-- ============================================ -->
            <!-- TO ADD/REMOVE PDF LINK:                      -->
            <!-- Delete the entire line below to remove link  -->
            <!-- Or change "rules.pdf" to your PDF filename   -->
            <!-- ============================================ -->
            <a href="rules.pdf" target="_blank" style="display:inline-block;background:linear-gradient(135deg, #c44569 0%, #6a1b9a 100%);color:white;padding:12px 30px;border-radius:8px;text-decoration:none;font-weight:600;margin-bottom:20px;">
                üìÑ Download Complete Rules & Regulations PDF (Coming Soon)
            </a>
        </div>

        <!-- ============================================ -->
        <!-- TO EDIT COORDINATOR NAMES:                   -->
        <!-- Change the names below                       -->
        <!-- ============================================ -->
        <div style="background:#fff3cd;padding:20px;border-radius:8px;border-left:5px solid #ffc107;margin-bottom:20px;">
            <p style="margin:0;color:#856404;font-weight:600;">Event Coordinators: Lalitha S K & Priyanka V</p>
        </div>

        <!-- ============================================ -->
        <!-- TO EDIT RULES: Change the text below         -->
        <!-- Keep the HTML tags as they are               -->
        <!-- ============================================ -->
        <div style="background:white;padding:25px;border-radius:8px;border:2px solid #e0e0e0;">
            <ol style="line-height:1.8;color:#333;">
                <!-- Rule 1 -->
                <li style="margin-bottom:15px;">
                    <strong>Last date for registration</strong> with one time Refundable amount 
                    <span style="color:#c44569;font-weight:bold;">‚Çπ1,500/-</span> 
                    on or before 
                    <span style="color:#c44569;font-weight:bold;">23rd February, Monday within 3:30 PM</span>.
                </li>
                
                <!-- Rule 2 -->
                <li style="margin-bottom:15px;">
                    <strong>Last date for submission of Music and Work Organising batch</strong> 
                    on or before 
                    <span style="color:#c44569;font-weight:bold;">7th March, Saturday</span>.
                </li>
                
                <!-- Rule 3 -->
                <li style="margin-bottom:15px;">
                    Students arriving late (Event and for the Class registration on the date of event) 
                    or absent for the event will be fined 
                    <span style="color:#c44569;font-weight:bold;">‚Çπ500/- per day</span>.
                </li>
                
                <!-- Rule 4 -->
                <li style="margin-bottom:15px;">
                    Teams not submitting Music, or any other assignments with respect to the event, 
                    on date and time, will lead into 
                    <span style="color:#c44569;font-weight:bold;">non-refund of deposit ‚Çπ1,500/-</span>.
                </li>
            </ol>
        </div>
    </div>
    <!-- ============================================ -->
    <!-- END OF RULES SECTION                         -->
    <!-- ============================================ -->
    
    <!-- Footer -->
    <footer style="background: white; border-radius: 12px; padding: 25px; margin-top: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
        <div style="text-align: center;">
            
            <!-- ================================================== -->
            <!-- CIRCULAR LOGO (Top)                                -->
            <!-- Replace "davan_logo_2026.gif" with your image file -->
            <!-- ================================================== -->
            <div style="margin-bottom: 0px;">
                <img src="davan_logo_2026.gif" alt="Spurthi Davan Logo" style="height: 200px; width: auto; display: inline-block;">
            </div>
            
            <p style="color: #6a1b9a; font-size: 0.9em; margin-bottom: 8px;">
                ¬© 2026 Davan Institute of Advanced Management Studies
            </p>
            
            <!-- ============================================ -->
            <!-- SUPER ADMIN: UPDATE VERSION AND DATE HERE    -->
            <!-- ============================================ -->
            <p style="color: #666; font-size: 0.85em; margin-bottom: 8px;">
                <strong>Version:</strong> 1.0 | <strong>Last Updated:</strong> February 13, 2026
            </p>
            <!-- ============================================ -->
            
            <p style="color: #c44569; font-size: 0.85em; font-weight: 600; margin-bottom: 8px;">
                Built by Harsha Gujjar, Director - Davan College
            </p>
            
            <!-- ================================================== -->
            <!-- TEXT LOGO (Below "Built by" line)                  -->
            <!-- Replace "davan_logo.png" with your image file      -->
            <!-- ================================================== -->
            <div style="margin-top: 5px;">
                <img src="davan_logo.png" alt="Davan Text Logo" style="height: 40px; width: auto; display: inline-block;">
            </div>
            
        </div>
    </footer>
</body>
</html>
